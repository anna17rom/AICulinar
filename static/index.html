<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Manager</title>
    <style>
        body {
            display: flex;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
            position: relative;
        }
        #sidebar {
            width: 250px;
            background-color: #2c3e50;
            padding: 20px;
            height: 100vh;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            transition: left 0.3s;
        }
        #content {
            flex-grow: 1;
            padding: 40px 60px; /* Increased horizontal padding */
            margin-left: 290px; /* Increased from 250px to add space after sidebar */
            transition: margin-left 0.3s;
            max-width: 1200px; /* Increased max-width for better layout */
        }
        .hidden {
            display: none;
        }
        #profileButton {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        #profileButton:hover {
            background-color: #c0392b;
        }
        #menuButton {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        #menuButton:hover {
            background-color: #2980b9;
        }
        #menuOptions button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        #menuOptions button:hover {
            background-color: #2c3e50;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        #recipeList {
            list-style-type: none;
            padding: 0;
        }
        #recipeList li {
            cursor: pointer;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.3s;
        }
        #recipeList li:hover {
            background-color: #ecf0f1;
        }
        #recipeDetails {
            margin-top: 30px;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        form {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button[type="submit"] {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button[type="submit"]:hover {
            background-color: #27ae60;
        }
        #recipeImage {
            max-width: 100%;
            height: auto;
            margin-top: 20px;
        }
        /* Shopping List Styles */
        .shopping-list-container {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .add-item-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .add-item-form input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .list-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        #shoppingList {
            list-style-type: none;
            padding: 0;
        }
        .shopping-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #f8f9fa;
            margin-bottom: 5px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .shopping-item:hover {
            background-color: #e9ecef;
        }
        .shopping-item.checked {
            background-color: #e9ecef;
            text-decoration: line-through;
            color: #6c757d;
        }
        .shopping-item input[type="checkbox"] {
            margin-right: 10px;
        }
        .shopping-item-text {
            flex-grow: 1;
        }
        .delete-item {
            color: #dc3545;
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px 10px;
            font-size: 16px;
        }
        .delete-item:hover {
            color: #c82333;
        }
        /* Main Page and Search Styles */
        #mainSection {
            display: block;
        }
        .search-container {
            background-color: white;
            padding: 20px 30px; /* Increased padding */
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            gap: 15px; /* Increased gap */
        }
        .search-container input {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .search-container button {
            padding: 12px 24px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .search-container button:hover {
            background-color: #2980b9;
        }
        .recipe-feed {
            margin-top: 20px;
        }
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px; /* Increased gap between recipe cards */
            padding: 20px 0;
        }
        .recipe-post {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }
        .recipe-post:hover {
            transform: translateY(-5px);
        }
        .recipe-post img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .recipe-post-content {
            padding: 15px;
        }
        .recipe-post h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 18px;
        }
        .recipe-post p {
            margin: 0;
            color: #666;
            font-size: 14px;
            line-height: 1.4;
            /* Limit text to 2 lines */
            display: -webkit-box;
            
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Sidebar Toggle Styles */
        .sidebar-toggle {
            position: fixed;
            top: 50%;
            left: 290px; /* Match the new margin-left of content */
            transform: translateY(-50%);
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            padding: 15px 10px;
            cursor: pointer;
            z-index: 1000;
            transition: left 0.3s;
        }
        .sidebar-toggle:hover {
            background-color: #34495e;
        }
        .toggle-icon {
            display: inline-block;
            transition: transform 0.3s;
        }
        /* Styles for collapsed state */
        .sidebar-collapsed #sidebar {
            left: -250px;
        }
        .sidebar-collapsed #content {
            margin-left: 40px; /* Add some space even when sidebar is collapsed */
        }
        .sidebar-collapsed .sidebar-toggle {
            left: 0;
        }
        .sidebar-collapsed .toggle-icon {
            transform: rotate(180deg);
        }
        /* Add some breathing room to the recipe feed title */
        .recipe-feed h2 {
            margin: 40px 0 20px 0;
        }
        /* Shopping List Styles */
        .add-item-button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .add-item-button:hover {
            background-color: #2980b9;
        }

        .shopping-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: white;
            margin-bottom: 8px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .shopping-item:hover {
            background-color: #f8f9fa;
        }

        .shopping-item input[type="checkbox"] {
            margin-right: 15px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .shopping-item.checked {
            background-color: #f8f9fa;
        }

        .shopping-item.checked .shopping-item-text {
            text-decoration: line-through;
            color: #6c757d;
        }

        .shopping-item-text {
            flex-grow: 1;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .delete-item {
            color: #dc3545;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            padding: 0 10px;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .delete-item:hover {
            opacity: 1;
        }

        .recipe-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
        }

        .recipe-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .recipe-info {
            padding: 15px;
        }

        .recipe-info h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 18px;
        }

        .recipe-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }

        .recipe-meta span {
            background: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .recipe-ingredients {
            margin: 10px 0;
            font-size: 14px;
        }

        .recipe-ingredients p {
            margin: 5px 0;
            color: #666;
        }

        .view-recipe-btn {
            width: 100%;
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .view-recipe-btn:hover {
            background-color: #2980b9;
        }

        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        #recipeGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        #recipeFilters {
            padding: 20px;
            background-color: #f5f5f5;
            margin-bottom: 20px;
        }

        #recipeFilters input,
        #recipeFilters select {
            margin-right: 10px;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            width: 80%;
            max-width: 500px;
            border-radius: 5px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 10px;
            top: 10px;
            font-size: 24px;
            cursor: pointer;
        }

        .modal.show {
            display: block;
        }

        #myRecipes {
            margin-top: 20px;
        }

        .recipe-category {
            margin-bottom: 20px;
        }

        .recipe-category h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .recipe-list {
            list-style-type: none;
            padding: 0;
        }

        .recipe-list li {
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.3s;
        }

        .recipe-list li:hover {
            background-color: #d5dbdb;
        }

        #profileOptions {
            display: flex;
            flex-direction: column;
        }

        #profileOptions.hidden {
            display: none;
        }

        #recipeOptions {
            display: flex;
            flex-direction: column;
            padding-left: 20px;
        }

        #recipeOptions.hidden {
            display: none;
        }

        /* Style for all sidebar buttons */
        #sidebar button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            color: white;
        }

        /* Menu button style */
        #menuButton {
            background-color: #3498db;
        }

        #menuButton:hover {
            background-color: #2980b9;
        }

        /* Profile button style */
        #profileButton {
            background-color: #3498db;
        }

        #profileButton:hover {
            background-color: #2980b9;
        }

        /* Style for My Recipes button */
        #myRecipesButton {
            background-color: #3498db !important;
            color: white !important;
            font-size: 16px !important;
        }

        #myRecipesButton:hover {
            background-color: #2980b9 !important;
        }

        /* Style for recipe option buttons (Liked, Added, Want to Try) */
        #recipeOptions button {
            background-color: #3498db !important;
            color: white !important;
            font-size: 16px !important;
            padding: 12px !important;
            margin-bottom: 10px !important;
        }

        #recipeOptions button:hover {
            background-color: #2980b9 !important;
        }

        /* Remove any conflicting styles */
        #profileOptions button,
        #menuOptions button {
            background-color: #3498db;
            color: white;
        }

        #profileOptions button:hover,
        #menuOptions button:hover {
            background-color: #2980b9;
        }

        /* Sign in/up buttons */
        #signinButton,
        #signupButton {
            background-color: #3498db;
        }

        #signinButton:hover,
        #signupButton:hover {
            background-color: #2980b9;
        }

        .recipe-actions {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .like-button, .want-to-try-button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .like-button {
            background-color: #ff4757;
            color: white;
        }

        .want-to-try-button {
            background-color: #2ed573;
            color: white;
        }

        .recipe-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .recipe-item:hover {
            transform: translateY(-2px);
        }

        .recipe-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
        }

        .recipe-info {
            flex: 1;
        }

        .recipe-section {
            margin-bottom: 30px;
        }

        .recipe-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .recipe-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        /* Modal form styles */
        .modal form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .modal input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .modal button[type="submit"] {
            padding: 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .modal button[type="submit"]:hover {
            background-color: #2980b9;
        }

        /* Ensure modals are on top */
        .modal {
            z-index: 1001;
        }

        .modal-content {
            z-index: 1002;
        }

        .cooked-button {
            background-color: #e67e22;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .cooked-button:hover {
            background-color: #d35400;
        }

        .profile-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .profile-info {
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .edit-button,
        .save-button,
        .cancel-button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }

        .edit-button {
            background-color: #3498db;
            color: white;
        }

        .save-button {
            background-color: #2ecc71;
            color: white;
        }

        .cancel-button {
            background-color: #e74c3c;
            color: white;
        }

        .profile-info p {
            margin: 10px 0;
            font-size: 16px;
        }

        .profile-info strong {
            color: #2c3e50;
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .recipe-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
        }

        .recipe-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .recipe-card-content {
            padding: 15px;
        }

        .recipe-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            background-color: #f8f9fa;
            border-radius: 8px;
            grid-column: 1 / -1;
        }

        .empty-state p {
            margin: 0;
            color: #6c757d;
            font-size: 16px;
        }

        .empty-state-subtitle {
            font-size: 14px;
            margin-top: 8px !important;
            color: #adb5bd !important;
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .recipe-section {
            margin: 20px 0;
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .recipe-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
        }

        .recipe-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .recipe-card-content {
            padding: 15px;
        }

        .recipe-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .hidden {
            display: none;
        }

        .small-modal {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .small-modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            width: 70%;
            max-width: 600px;
            border-radius: 8px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .small-modal-header {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .small-modal-header img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
        }

        .small-modal-title {
            flex: 1;
        }

        .small-modal-title h2 {
            margin: 0 0 10px 0;
            font-size: 1.5em;
            color: #2c3e50;
        }

        .recipe-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .recipe-meta span {
            background-color: #f0f2f5;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
        }

        .small-modal-body {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .ingredients-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .ingredients-section li {
            padding: 4px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .instructions-section p {
            margin-bottom: 10px;
            line-height: 1.4;
            font-size: 14px;
        }

        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .small-modal-content {
                width: 90%;
                margin: 5% auto;
            }

            .small-modal-header {
                flex-direction: column;
            }

            .small-modal-header img {
                width: 100%;
                height: 200px;
            }
        }

        .recipe-modal {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .recipe-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            border-radius: 8px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .recipe-modal-header {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .recipe-modal-header img {
            width: 300px;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
        }

        .recipe-modal-title {
            flex: 1;
        }

        .recipe-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .recipe-meta span {
            background-color: #f0f2f5;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .recipe-modal-body {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-top: 20px;
        }

        .ingredients-section ul {
            list-style: none;
            padding: 0;
        }

        .ingredients-section li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .instructions-section p {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #666;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .recipe-modal-header {
                flex-direction: column;
            }

            .recipe-modal-header img {
                width: 100%;
                height: 200px;
            }

            .recipe-modal-body {
                grid-template-columns: 1fr;
            }
        }

        /* Quick view modal styles */
        .quick-view-modal {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .quick-view-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            border-radius: 8px;
            position: relative;
        }

        .quick-view-details {
            margin-top: 15px;
        }

        .quick-view-details p {
            margin: 8px 0;
        }

        /* Full recipe modal styles */
        .full-recipe-modal {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .full-recipe-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            border-radius: 8px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Common styles */
        .close {
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .close:hover {
            color: #000;
        }

        #calorieCalculatorSection {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #2980b9;
        }

        #calorieResult {
            margin-top: 20px;
        }

        .rating-section {
            margin-top: 20px;
            text-align: center;
        }

        .star-rating {
            display: inline-flex;
            gap: 5px;
            margin: 10px 0;
        }

        .star {
            font-size: 24px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }

        .star.highlighted,
        .star.selected {
            color: #ffd700;
        }

        .rating-message {
            margin-top: 10px;
            font-size: 14px;
        }

        .rating-message.success {
            color: #4CAF50;
        }

        .rating-message.error {
            color: #f44336;
        }

        /* Add this CSS rule to ensure the button is visible */
        .view-details-btn {
            display: block; /* Change from inline-block to block */
            width: 100%; /* Make button full width */
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px; /* Add some space above the button */
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .view-details-btn:hover {
            background-color: #2980b9;
        }

        /* Enhanced AI-Culinar Button Styles */
        .analyze-button {
            position: relative;
            min-width: 200px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .analyze-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            background: linear-gradient(135deg, #2980b9, #3498db);
        }

        .analyze-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(52, 152, 219, 0.3);
        }

        .button-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .button-icon {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .analyze-button:hover .button-icon {
            transform: scale(1.1);
        }

        .button-text {
            font-family: 'Segoe UI', sans-serif;
            letter-spacing: 0.5px;
        }

        .button-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s linear infinite;
        }

        .hidden {
            display: none;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Disabled state */
        .analyze-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Success state */
        .analyze-button.success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }

        /* Error state */
        .analyze-button.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        /* Analysis Result Styles */
        .analysis-result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
            display: none;
        }

        .analysis-result.show {
            display: block;
        }

        .predictions-list {
            margin-top: 15px;
        }

        .prediction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .prediction-label {
            font-weight: 500;
            color: #2c3e50;
        }

        .prediction-probability {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .probability-bar {
            height: 4px;
            background-color: #e0e0e0;
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }

        .probability-fill {
            height: 100%;
            background-color: #3498db;
            transition: width 0.3s ease;
        }

        /* Add these to your existing styles */
        .hidden {
            display: none !important;
        }

        #content > div {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Ensure sections appear at the top */
        #content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Add smooth transitions */
        #content > div {
            transition: all 0.3s ease-in-out;
        }

        /* Style section headers */
        #content > div > h2 {
            margin-bottom: 30px;
            color: #2c3e50;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .search-and-filter-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .search-container {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-container input,
        .search-container select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .search-container input {
            flex: 1;
            min-width: 200px;
        }

        .search-container select {
            min-width: 150px;
        }

        .search-button {
            padding: 12px 24px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .search-button:hover {
            background-color: #2980b9;
        }

        /* Add these to your existing styles */
        .related-recipes {
            margin-top: 30px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recipe-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .find-recipes-btn {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .find-recipes-btn:hover {
            background-color: #45a049;
        }

        .hidden {
            display: none;
        }

        .recipe-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recipe-container img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .recipe-container h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .recipe-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #666;
        }

        .recipe-details div {
            background: #f5f5f5;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .key-ingredients {
            margin: 15px 0;
        }

        .key-ingredients h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .key-ingredients p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .recipe-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .action-btn {
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .action-btn:hover {
            background-color: #2980b9;
        }

        .view-full-recipe-btn {
            width: 100%;
            padding: 10px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .view-full-recipe-btn:hover {
            background-color: #27ae60;
        }

        .recipe-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .recipe-result-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recipe-result-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .recipe-result-card h3 {
            margin: 10px 0;
            color: #333;
            font-size: 18px;
        }

        .recipe-meta-info {
            margin: 10px 0;
            color: #666;
            font-size: 14px;
        }

        .recipe-meta-info div {
            margin: 5px 0;
        }

        .recipe-ingredients {
            margin: 15px 0;
        }

        .recipe-ingredients h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .recipe-ingredients p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .recipe-action-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .recipe-action-buttons button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #52b3d9;
            color: white;
            transition: background-color 0.3s;
        }

        .recipe-action-buttons button:hover {
            background-color: #4aa3c9;
        }

        .view-recipe-btn {
            width: 100%;
            padding: 10px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .view-recipe-btn:hover {
            background-color: #27ae60;
        }

        .like-btn, .want-to-try-btn, .cooked-btn {
            background-color: #52b3d9;
        }

        .like-btn:hover, .want-to-try-btn:hover, .cooked-btn:hover {
            background-color: #4aa3c9;
        }

        .recipe-result {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recipe-result img {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 4px;
        }

        .recipe-result h3 {
            margin: 10px 0;
            color: #333;
        }

        .key-ingredients {
            margin: 10px 0;
        }

        .key-ingredients h4 {
            margin: 5px 0;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .action-buttons button {
            padding: 8px 16px;
            background-color: #52b3d9;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .view-full-recipe {
            width: 100%;
            padding: 10px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .like, .want-to-try, .cooked {
            flex: 1;
        }

        .recipe-result > div {
            margin: 5px 0;
            color: #666;
        }

        .fridge-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .fridge-header {
            margin-bottom: 20px;
        }

        .add-ingredient-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .add-ingredient-form input,
        .add-ingredient-form select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }

        .add-ingredient-form button {
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        .add-ingredient-form button:hover {
            background-color: #2980b9;
        }

        .fridge-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .fridge-category {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .ingredient-list {
            margin-top: 10px;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: white;
            margin-bottom: 8px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .ingredient-info {
            flex-grow: 1;
        }

        .ingredient-name {
            font-weight: bold;
        }

        .expiry-date {
            font-size: 0.9em;
            color: #666;
        }

        .delete-ingredient {
            color: #e74c3c;
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }

        .expiring-soon {
            border-left: 3px solid #f1c40f;
        }

        .expired {
            border-left: 3px solid #e74c3c;
        }

        .fridge-recommendations {
            margin-top: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .recipe-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: white;
            transition: transform 0.2s;
        }

        .recipe-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .recipe-title {
            font-size: 1.2em;
            font-weight: bold;
        }

        .match-percentage {
            background-color: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.9em;
        }

        .recipe-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .recipe-ingredients {
            font-size: 0.9em;
            color: #666;
        }

        .recipe-ingredients span {
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            margin-bottom: 5px;
            display: inline-block;
        }

        .recipe-stats {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 0.9em;
        }

        .recipe-detail-modal {
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .recipe-detail-modal .recipe-image {
            width: 100%;
            max-height: 300px;
            overflow: hidden;
            border-radius: 8px;
            margin: 15px 0;
        }

        .recipe-detail-modal .recipe-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .recipe-detail-modal .recipe-info {
            padding: 20px 0;
        }

        .recipe-detail-modal .recipe-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .recipe-detail-modal .recipe-stats span {
            background-color: #f0f0f0;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .recipe-detail-modal .recipe-ingredients ul,
        .recipe-detail-modal .recipe-instructions ol {
            padding-left: 20px;
            margin: 10px 0;
        }

        .recipe-detail-modal .recipe-ingredients li,
        .recipe-detail-modal .recipe-instructions li {
            margin: 8px 0;
            line-height: 1.4;
        }

        .recipe-detail-modal h3 {
            margin: 20px 0 10px 0;
            color: #333;
        }

        .survey-button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        .survey-button:hover {
            background-color: #2980b9;
        }

        .survey-modal {
            width: 90%;
            max-width: 800px;
            margin: 5% auto;
        }

        .survey-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .survey-section h3 {
            margin-top: 0;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .submit-survey {
            background-color: #2ecc71;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        .submit-survey:hover {
            background-color: #27ae60;
        }

        /* Update the existing style section with these additional/modified styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto; /* Enable vertical scrolling for the modal background */
        }

        .survey-modal {
            width: 90%;
            max-width: 800px;
            margin: 20px auto; /* Changed from percentage to fixed margin */
            max-height: 90vh; /* Set maximum height to 90% of viewport height */
            overflow-y: auto; /* Enable vertical scrolling for the modal content */
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            position: relative;
        }

        /* Add smooth scrolling behavior */
        .survey-modal {
            scroll-behavior: smooth;
        }

        /* Style the scrollbar */
        .survey-modal::-webkit-scrollbar {
            width: 8px;
        }

        .survey-modal::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .survey-modal::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .survey-modal::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Make the close button stick to the top */
        .survey-modal .close {
            position: sticky;
            top: 0;
            right: 20px;
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            z-index: 1;
            background-color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .survey-modal .close:hover {
            color: #555;
        }

        /* Add some padding to the bottom for better scrolling experience */
        #surveyForm {
            padding-bottom: 40px;
        }

        /* Make sure form elements don't overflow */
        .form-group {
            max-width: 100%;
        }

        /* Ensure inputs and selects don't overflow */
        .form-group input,
        .form-group select,
        .form-group textarea {
            max-width: 100%;
            box-sizing: border-box;
        }

        /* Add some spacing between sections */
        .survey-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Add smooth transition for modal */
        .modal {
            transition: opacity 0.3s ease-in-out;
        }

        /* Add responsive padding */
        @media (max-width: 768px) {
            .survey-modal {
                width: 95%;
                margin: 10px auto;
                padding: 15px;
            }

            .survey-section {
                padding: 15px;
            }
        }

        .recommendations-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .recommendations-header {
            margin-bottom: 20px;
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 10px;
        }

        .recipe-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
        }

        .recipe-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .recipe-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .match-percentage {
            color: #2ecc71;
            font-weight: bold;
        }

        .recipe-details {
            padding: 15px;
        }

        .recipe-ingredients {
            margin-bottom: 15px;
            font-size: 14px;
        }

        .recipe-ingredients span {
            display: inline-block;
            background-color: #f8f9fa;
            padding: 3px 8px;
            margin: 2px;
            border-radius: 4px;
            font-size: 12px;
        }

        .recipe-stats {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 14px;
        }

        .view-recipe-btn {
            width: 100%;
            padding: 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 0 0 8px 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .view-recipe-btn:hover {
            background-color: #2980b9;
        }

        .fridge-recommendations {
            margin-top: 30px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .action-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px 0;
            transition: background-color 0.3s;
        }

        .action-button:hover {
            background-color: #2980b9;
        }

        #fridgeRecipeRecommendations {
            margin-top: 20px;
        }

        #fridgeRecipeRecommendations .recipe-card {
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .match-info {
            padding: 10px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
        }

        .match-percentage {
            color: #2ecc71;
            font-weight: bold;
            font-size: 1.1em;
        }

        .ingredients-match {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .recipe-actions {
            padding: 15px;
            border-top: 1px solid #eee;
        }

        .recipe-list-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .list-action-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .liked-btn {
            background-color: #ff6b6b;
            color: white;
        }

        .liked-btn:hover {
            background-color: #ff5252;
        }

        .cooked-btn {
            background-color: #51cf66;
            color: white;
        }

        .cooked-btn:hover {
            background-color: #40c057;
        }

        .want-to-try-btn {
            background-color: #339af0;
            color: white;
        }

        .want-to-try-btn:hover {
            background-color: #228be6;
        }

        .icon {
            font-size: 16px;
        }

        /* Update recipe card styles */
        .recipe-card {
            display: flex;
            flex-direction: column;
        }

        .recipe-details {
            flex-grow: 1;
            padding: 15px;
        }

        .view-recipe-btn {
            width: 100%;
            padding: 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .view-recipe-btn:hover {
            background-color: #2980b9;
        }

        .shopping-list {
            list-style: none;
            padding: 0;
        }

        .shopping-list-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s;
        }

        .shopping-list-item:hover {
            background-color: #f8f9fa;
        }

        .shopping-list-checkbox {
            margin-right: 10px;
        }

        .shopping-list-text {
            flex-grow: 1;
        }

        .shopping-list-delete {
            color: #e74c3c;
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }

        .add-to-fridge-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
        }

        .add-to-fridge-btn:hover {
            background-color: #27ae60;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background-color: white;
            margin-bottom: 8px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .ingredient-info {
            flex-grow: 1;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 10px;
            align-items: center;
        }

        .ingredient-name {
            font-weight: bold;
        }

        .ingredient-details {
            color: #666;
            font-size: 0.9em;
        }

        .expiry-date {
            color: #666;
        }

        .delete-ingredient {
            color: #e74c3c;
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }

        .expiring-soon {
            border-left: 3px solid #f1c40f;
        }

        .expired {
            border-left: 3px solid #e74c3c;
        }

        .profile-preferences {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .preferences-container {
            display: grid;
            gap: 20px;
            margin-top: 15px;
        }

        .preference-group {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .preference-group h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .preference-group p {
            color: #34495e;
            margin: 0;
        }

        .edit-preferences-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .edit-preferences-btn:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <button id="menuButton">Menu</button>
        <button id="profileButton" class="hidden">My Profile</button>
        <div id="profileOptions" class="hidden">
            <button id="myRecipesButton">My Recipes</button>
            <button id="myFridgeButton">My Fridge</button>
            <button id="shoppingListButton">Shopping List</button>
            <div id="recipeOptions" class="hidden">
                <button id="likedRecipesButton">Liked Recipes</button>
                <button id="cookedRecipesButton">Cooked Recipes</button>
                <button id="wantToTryRecipesButton">Want to Try</button>
                <button id="addedRecipesButton">Added Recipes</button>
            </div>
        </div>
        <button id="signupButton">Sign Up</button>
        <button id="signinButton">Sign In</button>
        <div id="menuOptions" class="hidden">
            <button id="addRecipeButton">Add Recipe</button>
            <button id="viewRecipesButton">View Recipes</button>
            <button id="calorieCalculatorButton">Calorie Calculator</button>
            <button id="aiCulinarButton">AI Culinar</button>
            <button id="recipeRecommendationsButton">Recipe Recommendations</button>
        </div>
    </div>
    
    <div id="content">
        <h1>Recipe Manager</h1>
        
        <div id="mainSection">
            <div class="search-and-filter-container">
                <form id="mainSearchForm" class="search-container">
                    <input type="text" id="searchInput" placeholder="Search recipes...">
                    <select id="mainSortSelect">
                        <option value="">Sort by...</option>
                        <option value="name">Name</option>
                        <option value="difficulty">Difficulty</option>
                        <option value="time">Cooking Time</option>
                        <option value="calories">Calories</option>
                    </select>
                    <select id="mainCuisineFilter">
                        <option value="">All Cuisines</option>
                        <!-- Will be populated dynamically -->
                    </select>
                    <select id="mainDifficultyFilter">
                        <option value="">All Difficulties</option>
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                    <button type="submit" class="search-button">Search</button>
                </form>
            </div>
            <div class="recipe-feed">
                <h2>Featured Recipes</h2>
                <div id="recipePosts" class="recipe-grid">
                    <!-- Recipes will be displayed here -->
                </div>
            </div>
        </div>

        <div id="addRecipeSection" class="hidden">
            <h2>Add Recipe</h2>
            <form id="recipeForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="recipeName">Recipe Name:</label>
                    <input type="text" id="recipeName" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="ingredients">Ingredients (one per line or comma-separated):</label>
                    <textarea id="ingredients" name="ingredients" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="instructions">Instructions:</label>
                    <textarea id="instructions" name="instructions" required></textarea>
                </div>

                <div class="form-group">
                    <label for="cuisine">Cuisine:</label>
                    <input type="text" id="cuisine" name="cuisine">
                </div>

                <div class="form-group">
                    <label for="time">Cooking Time (minutes):</label>
                    <input type="number" id="time" name="time" value="30">
                </div>

                <div class="form-group">
                    <label for="calories">Calories:</label>
                    <input type="number" id="calories" name="calories" value="0">
                </div>

                <div class="form-group">
                    <label for="recipeImage">Recipe Image (optional):</label>
                    <input type="file" id="recipeImage" name="image" accept="image/*">
                </div>

                <button type="submit" class="add-recipe-btn">Add Recipe</button>
            </form>
        </div>

        <div id="viewRecipesSection">
            <h2>All Recipes</h2>
            <div id="recipeFilters">
                <input type="text" id="searchRecipes" placeholder="Search recipes...">
                <select id="cuisineFilter">
                    <option value="">All Cuisines</option>
                </select>
                <select id="difficultyFilter">
                    <option value="">All Difficulties</option>
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Hard">Hard</option>
                </select>
            </div>
            <div id="recipeGrid"></div>
        </div>

        <div id="shoppingListSection" class="hidden">
            <h2>Shopping List</h2>
            <div class="shopping-list-container">
                <div class="add-item-form">
                    <input type="text" id="newItem" placeholder="Enter item">
                    <button class="add-item-button" onclick="addShoppingItem()">Add Item</button>
                </div>
                <ul id="shoppingList" class="shopping-list"></ul>
            </div>

            <!-- Add a modal for entering additional details when checking off items -->
            <div id="addToFridgeModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3>Add to My Fridge</h3>
                    <form id="addToFridgeForm">
                        <div class="form-group">
                            <label for="modalIngredientName">Item:</label>
                            <input type="text" id="modalIngredientName" readonly>
                        </div>
                        <div class="form-group">
                            <label for="modalIngredientCategory">Category:</label>
                            <select id="modalIngredientCategory" required>
                                <option value="">Select Category</option>
                                <option value="dairy">Dairy & Eggs</option>
                                <option value="meat">Meat & Poultry</option>
                                <option value="fish">Fish & Seafood</option>
                                <option value="vegetables">Vegetables</option>
                                <option value="fruits">Fruits</option>
                                <option value="grains">Grains & Pasta</option>
                                <option value="pantry">Pantry Items</option>
                                <option value="spices">Spices & Herbs</option>
                                <option value="beverages">Beverages</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="modalIngredientAmount">Amount:</label>
                            <input type="number" id="modalIngredientAmount" min="0" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="modalIngredientUnit">Unit:</label>
                            <select id="modalIngredientUnit" required>
                                <option value="pieces">pieces</option>
                                <option value="g">grams</option>
                                <option value="kg">kilograms</option>
                                <option value="ml">milliliters</option>
                                <option value="l">liters</option>
                                <option value="tbsp">tablespoons</option>
                                <option value="tsp">teaspoons</option>
                                <option value="cups">cups</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="modalExpiryDate">Expiry Date:</label>
                            <input type="date" id="modalExpiryDate" required>
                        </div>
                        <button type="submit" class="add-to-fridge-btn">Add to Fridge</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="calorieCalculatorSection" class="hidden">
            <h2>Calorie Calculator</h2>
            <form id="calorieCalculatorForm">
                <div class="form-group">
                    <label for="sex">Sex:</label>
                    <select id="sex" required>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="age">Age (years):</label>
                    <input type="number" id="age" min="1" required>
                </div>
                <div class="form-group">
                    <label for="height">Height (cm):</label>
                    <input type="number" id="height" min="1" required>
                </div>
                <div class="form-group">
                    <label for="weight">Current Weight (kg):</label>
                    <input type="number" id="weight" min="1" required>
                </div>
                <div class="form-group">
                    <label for="activityLevel">Activity Level:</label>
                    <select id="activityLevel" required>
                        <option value="sedentary">Sedentary (little or no exercise)</option>
                        <option value="light">Lightly active (light exercise/sports 1-3 days/week)</option>
                        <option value="moderate">Moderately active (moderate exercise/sports 3-5 days/week)</option>
                        <option value="active">Active (hard exercise/sports 6-7 days a week)</option>
                        <option value="veryActive">Very active (very hard exercise/sports & a physical job)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="goal">Goal:</label>
                    <select id="goal" required>
                        <option value="maintain">Maintain Weight</option>
                        <option value="lose">Lose Weight</option>
                        <option value="gain">Gain Weight</option>
                    </select>
                </div>
                <button type="submit">Calculate Calories</button>
            </form>
            <div id="calorieResult" class="hidden">
                <h3>Your Daily Caloric Needs:</h3>
                <p id="calories"></p>
            </div>
        </div>


        <div id="aiCulinarSection" class="hidden">
            <div class="ai-culinar-container">
                <div class="ai-culinar-header">
                    <h2>AI-Culinar: Your Smart Recipe Assistant</h2>
                    <p class="ai-description">Upload a photo of your ingredients, and let our AI suggest delicious recipes you can make!</p>
                </div>
                
                <div class="upload-container">
                    <div class="upload-box">
                        <label for="productImageInput" class="upload-label">
                            <i class="upload-icon">📸</i>
                            <span>Choose a photo or drag it here</span>
                        </label>
                        <input type="file" id="productImageInput" accept="image/*" class="file-input">
                    </div>
                    <button id="analyzeButton" class="analyze-button">
                        <div class="button-content">
                            <span class="button-icon">🔍</span>
                            <span class="button-text">Analyze Ingredients</span>
                        </div>
                        <div class="button-loading hidden">
                            <div class="loading-spinner"></div>
                            <span>Analyzing...</span>
                        </div>
                    </button>
                </div>

                <!-- Add this after the upload-container div -->
                <div class="analysis-results-container">
                    <div id="analysisResult" class="analysis-result">
                        <div id="predictionsList" class="predictions-list"></div>
                    </div>
                    
                    <!-- Add this new section for recipes -->
                    <div id="relatedRecipes" class="related-recipes hidden">
                        <h3>Recipes with detected ingredients:</h3>
                        <div id="recipeResults" class="recipe-results-grid"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="profileSection" class="hidden">
            <h2>My Profile</h2>
            <div class="profile-container">
                <div class="profile-info">
                    <div id="userInfoDisplay">
                        <!-- Profile info will be displayed here -->
                    </div>
                    <button id="editProfileBtn" class="edit-button">Edit Profile</button>
                </div>
                
                <div id="profileForm" class="hidden">
                    <form id="userProfileForm">
                        <div class="form-group">
                            <label for="userName">Name:</label>
                            <input type="text" id="userName" required>
                        </div>
                        <div class="form-group">
                            <label for="userAge">Age:</label>
                            <input type="number" id="userAge" min="1" max="120" required>
                        </div>
                        <div class="form-group">
                            <label for="userHeight">Height (cm):</label>
                            <input type="number" id="userHeight" min="1" max="300" required>
                        </div>
                        <div class="form-group">
                            <label for="userWeight">Weight (kg):</label>
                            <input type="number" id="userWeight" min="1" max="500" required>
                        </div>
                        <div class="form-group">
                            <label for="userGoal">Goal:</label>
                            <select id="userGoal" required>
                                <option value="lose_weight">Lose Weight</option>
                                <option value="maintain_weight">Maintain Weight</option>
                                <option value="gain_weight">Gain Weight</option>
                            </select>
                        </div>
                        <button type="submit" class="save-button">Save Profile</button>
                        <button type="button" id="cancelEditBtn" class="cancel-button">Cancel</button>
                    </form>
                </div>

                <div class="recipe-lists">
                    <h3>My Recipe Collections</h3>
                    <div id="recipeLists">
                        <!-- Existing recipe lists -->
                    </div>
                </div>

                <button id="surveyButton" class="survey-button">Take Survey</button>
            </div>
        </div>

        <div id="myFridgeSection" class="hidden">
            <h2>My Fridge</h2>
            
            <!-- Existing fridge content -->
            <div class="fridge-container">
                <div class="fridge-header">
                    <div class="search-container">
                        <input type="text" id="fridgeSearch" placeholder="Search ingredients...">
                    </div>
                    <div class="add-ingredient-form">
                        <input type="text" id="ingredientName" placeholder="Ingredient name" required>
                        <select id="ingredientCategory" required>
                            <option value="">Select Category</option>
                            <option value="dairy">Dairy & Eggs</option>
                            <option value="meat">Meat & Poultry</option>
                            <option value="fish">Fish & Seafood</option>
                            <option value="vegetables">Vegetables</option>
                            <option value="fruits">Fruits</option>
                            <option value="grains">Grains & Pasta</option>
                            <option value="pantry">Pantry Items</option>
                            <option value="spices">Spices & Herbs</option>
                            <option value="beverages">Beverages</option>
                            <option value="other">Other</option>
                        </select>
                        <input type="number" id="ingredientAmount" placeholder="Amount" min="0" step="0.1" required>
                        <select id="ingredientUnit" required>
                            <option value="">Select Unit</option>
                            <option value="pieces">pieces</option>
                            <option value="g">grams</option>
                            <option value="kg">kilograms</option>
                            <option value="ml">milliliters</option>
                            <option value="l">liters</option>
                            <option value="tbsp">tablespoons</option>
                            <option value="tsp">teaspoons</option>
                            <option value="cups">cups</option>
                        </select>
                        <input type="date" id="expiryDate" required>
                        <button onclick="addToFridge()">Add to Fridge</button>
                    </div>
                </div>
                
                <div class="fridge-content">
                    <div class="fridge-category">
                        <h3>Fresh Ingredients</h3>
                        <div id="freshIngredients" class="ingredient-list"></div>
                    </div>
                    <div class="fridge-category">
                        <h3>Expiring Soon (Within 7 days)</h3>
                        <div id="expiringSoonIngredients" class="ingredient-list"></div>
                    </div>
                    <div class="fridge-category">
                        <h3>Expired</h3>
                        <div id="expiredIngredients" class="ingredient-list"></div>
                    </div>
                </div>
            </div>

            <!-- Add this new section for fridge-based recommendations -->
            <div class="fridge-recommendations">
                <h3>Recipes From Your Fridge</h3>
                <button id="showFridgeRecipesBtn" class="action-button">
                    Show Recipe Recommendations
                </button>
                <div id="fridgeRecipeRecommendations" class="recipe-grid hidden">
                    <!-- Recommendations will be loaded here -->
                </div>
            </div>
        </div>

        <div id="recipeRecommendationsSection" class="hidden">
            <h2>Recipe Recommendations</h2>
            <div class="recommendations-container">
                <div class="recommendations-header">
                    <h3>Based on Your Preferences</h3>
                    <p>Here are some recipes we think you'll love:</p>
                </div>
                <div id="recipeRecommendations" class="recipe-grid">
                    <!-- Recommendations will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add this button after the sidebar div -->
    <button id="sidebarToggle" class="sidebar-toggle">
        <span class="toggle-icon">◀</span>
    </button>

    <div id="signinModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Sign In</h2>
            <form id="signinForm">
                <input type="email" id="signinEmail" placeholder="Email" required>
                <input type="password" id="signinPassword" placeholder="Password" required>
                <button type="submit">Sign In</button>
            </form>
        </div>
    </div>

    <div id="signupModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Sign Up</h2>
            <form id="signupForm">
                <input type="text" id="signupName" placeholder="Full Name" required>
                <input type="email" id="signupEmail" placeholder="Email" required>
                <input type="password" id="signupPassword" placeholder="Password" required>
                <button type="submit">Sign Up</button>
            </form>
        </div>
    </div>

    <div id="likedRecipesSection" class="recipe-section hidden">
        <h3>Liked Recipes</h3>
        <div class="recipe-grid" id="likedRecipesList"></div>
    </div>

    <div id="cookedRecipesSection" class="recipe-section hidden">
        <h3>Cooked Recipes</h3>
        <div class="recipe-grid" id="cookedRecipesList"></div>
    </div>

    <div id="wantToTryRecipesSection" class="recipe-section hidden">
        <h3>Want to Try Recipes</h3>
        <div class="recipe-grid" id="want_to_tryRecipesList"></div>
    </div>

    <!-- Add this with your other recipe sections -->
    <div id="addedRecipesSection" class="recipe-section hidden">
        <h3>Added Recipes</h3>
        <div class="recipe-grid" id="addedRecipesList"></div>
    </div>

    

    <!-- Add this modal markup at the end of the body, before closing body tag -->
    <div id="surveyModal" class="modal">
        <div class="modal-content survey-modal">
            <span class="close">&times;</span>
            <h2>Food Preferences Survey</h2>
            <form id="surveyForm">
                <!-- Allergies Section -->
                <div class="survey-section">
                    <h3>Allergies and Food Intolerances</h3>
                    <div class="form-group">
                        <label>Do you have any food allergies?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="has_allergies" value="yes"> Yes</label>
                            <label><input type="radio" name="has_allergies" value="no"> No</label>
                        </div>
                    </div>

                    <div class="form-group allergy-options" style="display: none;">
                        <label>Select your allergies/intolerances:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="allergies" value="nuts"> Nuts</label>
                            <label><input type="checkbox" name="allergies" value="dairy"> Dairy products</label>
                            <label><input type="checkbox" name="allergies" value="gluten"> Gluten</label>
                            <label><input type="checkbox" name="allergies" value="eggs"> Eggs</label>
                            <label><input type="checkbox" name="allergies" value="seafood"> Seafood</label>
                            <label><input type="checkbox" name="allergies" value="soy"> Soy products</label>
                        </div>
                        <div class="other-option">
                            <label>Other allergies:</label>
                            <input type="text" name="other_allergies" placeholder="Enter other allergies, separated by commas">
                        </div>
                    </div>
                </div>

                <!-- Diet Preferences Section -->
                <div class="survey-section">
                    <h3>Food Preferences</h3>
                    <div class="form-group">
                        <label>What type of diet suits you best?</label>
                        <select name="diet" required>
                            <option value="">Select your diet</option>
                            <option value="regular">Regular diet</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="vegan">Vegan</option>
                            <option value="pescatarian">Pescatarian</option>
                            <option value="paleo">Paleo</option>
                            <option value="keto">Keto</option>
                            <option value="gluten_free">Gluten-free</option>
                        </select>
                        <input type="text" name="other_diet" placeholder="Other diet (if not listed above)">
                    </div>

                    <div class="form-group">
                        <label>What is your preferred main meal time?</label>
                        <select name="meal_time" required>
                            <option value="">Select meal time</option>
                            <option value="breakfast">Breakfast</option>
                            <option value="lunch">Lunch</option>
                            <option value="dinner">Dinner</option>
                            <option value="snacks">Snacks throughout the day</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Preferred cuisines:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="cuisines" value="italian"> Italian</label>
                            <label><input type="checkbox" name="cuisines" value="asian"> Asian</label>
                            <label><input type="checkbox" name="cuisines" value="mexican"> Mexican</label>
                            <label><input type="checkbox" name="cuisines" value="french"> French</label>
                            <label><input type="checkbox" name="cuisines" value="mediterranean"> Mediterranean</label>
                            <label><input type="checkbox" name="cuisines" value="american"> American</label>
                            <label><input type="checkbox" name="cuisines" value="indian"> Indian</label>
                            <label><input type="checkbox" name="cuisines" value="eastern_european"> Eastern European</label>
                            <label><input type="checkbox" name="cuisines" value="middle_eastern"> Middle Eastern</label>
                        </div>
                        <input type="text" name="other_cuisines" placeholder="Other cuisines (separated by commas)">
                    </div>

                    <div class="form-group">
                        <label>Preferred food types:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="food_types" value="vegetables_fruits"> Vegetables and fruits</label>
                            <label><input type="checkbox" name="food_types" value="meat_poultry"> Meat and poultry</label>
                            <label><input type="checkbox" name="food_types" value="fish_seafood"> Fish and seafood</label>
                            <label><input type="checkbox" name="food_types" value="grains_legumes"> Grains and legumes</label>
                            <label><input type="checkbox" name="food_types" value="dairy"> Dairy products</label>
                            <label><input type="checkbox" name="food_types" value="nuts_seeds"> Nuts and seeds</label>
                            <label><input type="checkbox" name="food_types" value="sugar_free"> Sugar-free products</label>
                            <label><input type="checkbox" name="food_types" value="high_protein"> High-protein foods</label>
                        </div>
                        <input type="text" name="other_food_types" placeholder="Other food types (separated by commas)">
                    </div>
                </div>

                <!-- Taste Preferences Section -->
                <div class="survey-section">
                    <h3>Taste Preferences</h3>
                    <div class="form-group">
                        <label>How do you feel about spicy foods?</label>
                        <select name="spice_preference" required>
                            <option value="">Select spice preference</option>
                            <option value="love_spicy">Love spicy food</option>
                            <option value="moderate_spicy">Can eat a bit of spice</option>
                            <option value="mild_spicy">Prefer mild spice</option>
                            <option value="no_spicy">Don't like spicy food</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>What level of sweetness do you prefer?</label>
                        <select name="sweetness_preference" required>
                            <option value="">Select sweetness preference</option>
                            <option value="very_sweet">Very sweet</option>
                            <option value="moderately_sweet">Moderately sweet</option>
                            <option value="minimally_sweet">Minimally sweet</option>
                            <option value="no_sugar">No sugar at all</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Foods you dislike or avoid:</label>
                        <textarea name="disliked_foods" placeholder="Enter foods separated by commas"></textarea>
                    </div>
                </div>

                <!-- Preparation and Drinks Section -->
                <div class="survey-section">
                    <h3>Preparation and Drinks</h3>
                    <div class="form-group">
                        <label>Preferred preparation time:</label>
                        <select name="prep_time" required>
                            <option value="">Select preparation time</option>
                            <option value="long">Long preparation</option>
                            <option value="medium">Medium preparation time</option>
                            <option value="quick">Quick preparation</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Preferred drinks:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="drinks" value="water"> Water</label>
                            <label><input type="checkbox" name="drinks" value="tea"> Tea</label>
                            <label><input type="checkbox" name="drinks" value="coffee"> Coffee</label>
                            <label><input type="checkbox" name="drinks" value="juices"> Juices</label>
                            <label><input type="checkbox" name="drinks" value="carbonated"> Carbonated drinks</label>
                            <label><input type="checkbox" name="drinks" value="protein_shakes"> Protein shakes</label>
                        </div>
                        <input type="text" name="other_drinks" placeholder="Other drinks (separated by commas)">
                    </div>
                </div>

                <!-- Goals Section -->
                <div class="survey-section">
                    <h3>Dietary Goals</h3>
                    <div class="form-group">
                        <label>What are your dietary goals?</label>
                        <select name="dietary_goal" required>
                            <option value="">Select your goal</option>
                            <option value="weight_loss">Weight loss</option>
                            <option value="weight_gain">Weight gain</option>
                            <option value="weight_maintenance">Weight maintenance</option>
                            <option value="muscle_gain">Muscle gain</option>
                            <option value="energy_focus">Energy and focus support</option>
                            <option value="general_health">General health improvement</option>
                            <option value="blood_sugar">Blood sugar control</option>
                        </select>
                        <input type="text" name="other_goal" placeholder="Other goal (if not listed above)">
                    </div>

                    <div class="form-group">
                        <label>Preferred meal calorie content:</label>
                        <select name="calorie_preference" required>
                            <option value="">Select calorie preference</option>
                            <option value="low">Low-calorie meals (up to 200 kcal)</option>
                            <option value="medium">Medium-calorie meals (200-500 kcal)</option>
                            <option value="high">High-calorie meals (500+ kcal)</option>
                            <option value="no_preference">No specific preference</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="submit-survey">Submit Survey</button>
            </form>
        </div>
    </div>

    <!-- Add this JavaScript code -->
    <script>
        // Survey modal functionality
        const surveyButton = document.getElementById('surveyButton');
        const surveyModal = document.getElementById('surveyModal');
        const surveyForm = document.getElementById('surveyForm');
        const closeButton = surveyModal.querySelector('.close');

        surveyButton.addEventListener('click', () => {
            surveyModal.style.display = 'block';
        });

        closeButton.addEventListener('click', () => {
            surveyModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === surveyModal) {
                surveyModal.style.display = 'none';
            }
        });

        surveyForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(surveyForm);
            const surveyData = {
                has_allergies: formData.get('has_allergies'),
                allergies: formData.getAll('allergies'),
                other_allergies: formData.get('other_allergies'),
                diet: formData.get('diet'),
                other_diet: formData.get('other_diet'),
                meal_time: formData.get('meal_time'),
                cuisines: formData.getAll('cuisines'),
                other_cuisines: formData.get('other_cuisines'),
                food_types: formData.getAll('food_types'),
                other_food_types: formData.get('other_food_types'),
                spice_preference: formData.get('spice_preference'),
                sweetness_preference: formData.get('sweetness_preference'),
                disliked_foods: formData.get('disliked_foods'),
                prep_time: formData.get('prep_time'),
                drinks: formData.getAll('drinks'),
                other_drinks: formData.get('other_drinks'),
                dietary_goal: formData.get('dietary_goal'),
                other_goal: formData.get('other_goal'),
                calorie_preference: formData.get('calorie_preference'),
                user_email: currentUserEmail
            };

            try {
                const response = await fetch('/update_user_preferences', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(surveyData)
                });

                if (response.ok) {
                    alert('Survey submitted successfully!');
                    surveyModal.style.display = 'none';
                } else {
                    throw new Error('Failed to submit survey');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to submit survey. Please try again.');
            }
        });
    </script>

    <script>
        const menuButton = document.getElementById('menuButton');
        const menuOptions = document.getElementById('menuOptions');
        const addRecipeButton = document.getElementById('addRecipeButton');
        const viewRecipesButton = document.getElementById('viewRecipesButton');
        const shoppingListButton = document.getElementById('shoppingListButton');
        const calorieCalculatorButton = document.getElementById('calorieCalculatorButton');
        const aiCulinarButton = document.getElementById('aiCulinarButton');
        const profileButton = document.getElementById('profileButton');
        const profileOptions = document.getElementById('profileOptions');


        const addRecipeSection = document.getElementById('addRecipeSection');
        const viewRecipesSection = document.getElementById('viewRecipesSection');
        const shoppingListSection = document.getElementById('shoppingListSection');
        const calorieCalculatorSection = document.getElementById('calorieCalculatorSection');
        const aiCulinarSection = document.getElementById('aiCulinarSection');
        const profileSection = document.getElementById('profileSection');

        function hideAllSections() {
            const sections = [
                'mainSection',
                'addRecipeSection',
                'viewRecipesSection',
                'shoppingListSection',
                'calorieCalculatorSection',
                'aiCulinarSection',
                'profileSection',
                'likedRecipesSection',
                'cookedRecipesSection',
                'wantToTryRecipesSection',
                'addedRecipesSection',
                'recipeFeed', // Ensure to hide the recipe feed (Latest Recipes)
                'recipeRecommendationsSection' // Add this line
            ];
            
            sections.forEach(section => {
                const element = document.getElementById(section);
                if (element) {
                    element.classList.add('hidden'); // Ensure all sections are hidden
                }
            });
        }

        menuButton.addEventListener('click', () => {
            hideAllSections();
            mainSection.classList.remove('hidden');
            menuOptions.classList.toggle('hidden');
        });

        addRecipeButton.addEventListener('click', () => {
            hideAllSections();
            addRecipeSection.classList.remove('hidden');
        });

        viewRecipesButton.addEventListener('click', () => {
            hideAllSections();
            viewRecipesSection.classList.remove('hidden');
            loadRecipes();
        });

        shoppingListButton.addEventListener('click', () => {
            hideAllSections(); // Hide all sections
            shoppingListSection.classList.remove('hidden'); // Show only the shopping list
            menuOptions.classList.add('hidden'); // Optionally hide menu options if needed
        });

        calorieCalculatorButton.addEventListener('click', () => {
            hideAllSections(); // Hide all sections
            calorieCalculatorSection.classList.remove('hidden'); // Show only the calorie calculator
            menuOptions.classList.add('hidden'); // Optionally hide menu options if needed
        });

        aiCulinarButton.addEventListener('click', () => {
            hideAllSections();
            aiCulinarSection.classList.remove('hidden');
            menuOptions.classList.add('hidden');
        });

        profileButton.addEventListener('click', () => {
            hideAllSections();
            profileSection.classList.remove('hidden');
            profileOptions.classList.toggle('hidden');
            menuOptions.classList.add('hidden'); // Hide menu options when profile is clicked
        });

        const myRecipesButton = document.getElementById('myRecipesButton');
        myRecipesButton.addEventListener('click', () => {
            const recipeOptions = document.getElementById('recipeOptions');
            recipeOptions.classList.toggle('hidden');
        });

        const likedRecipesButton = document.getElementById('likedRecipesButton');
        const cookedRecipesButton = document.getElementById('cookedRecipesButton');
        const wantToTryRecipesButton = document.getElementById('wantToTryRecipesButton');
        

        likedRecipesButton.addEventListener('click', () => {
            hideAllRecipeSections();
            document.getElementById('likedRecipesSection').classList.remove('hidden');
            loadUserRecipes('liked');
        });

        cookedRecipesButton.addEventListener('click', () => {
            hideAllRecipeSections();
            document.getElementById('cookedRecipesSection').classList.remove('hidden');
            loadUserRecipes('cooked');
        });

        wantToTryRecipesButton.addEventListener('click', () => {
            hideAllRecipeSections();
            document.getElementById('wantToTryRecipesSection').classList.remove('hidden');
            loadUserRecipes('want_to_try');
        });

        document.getElementById('addedRecipesButton').addEventListener('click', () => {
            console.log('Added Recipes button clicked'); // Debug log
            hideAllRecipeSections();
            const addedSection = document.getElementById('addedRecipesSection');
            addedSection.classList.remove('hidden');
            loadUserRecipes('added');
        });

        function hideAllRecipeSections() {
            const sections = [
                'likedRecipesSection',
                'cookedRecipesSection',
                'wantToTryRecipesSection',
                'addedRecipesSection'  // Add this line
            ];
            
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.add('hidden');
                }
            });
        }

        // Recipe Form Handling
        document.getElementById('recipeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            const name = document.getElementById('name').value;
            const ingredients = document.getElementById('ingredients').value;
            const instructions = document.getElementById('instructions').value;
            const imageFile = document.getElementById('image').files[0];
            
            // Debug logs
            console.log('Name:', name);
            console.log('Ingredients:', ingredients);
            console.log('Instructions:', instructions);
            console.log('Image file:', imageFile);
            
            // Validate input
            if (!name || !ingredients || !instructions) {
                alert('Please fill in all required fields');
                return;
            }
            
            formData.append('name', name);
            formData.append('ingredients', ingredients);
            formData.append('instructions', instructions);
            if (imageFile) {
                formData.append('image', imageFile);
                console.log('Image appended to form data');
            }

            try {
                console.log('Submitting form data...');
                const response = await fetch('/add_recipe', {
                    method: 'POST',
                    body: formData // FormData automatically sets the correct content-type
                });

                const result = await response.json();
                console.log('Server response:', result);
                
                if (response.ok) {
                    alert('Recipe added successfully!');
                    document.getElementById('recipeForm').reset();
                    loadRecipes();
                    hideAllSections();
                    viewRecipesSection.classList.remove('hidden');
                } else {
                    alert(`Error adding recipe: ${result.error}`);
                }
            } catch (error) {
                alert('Error adding recipe. Please try again.');
                console.error('Error:', error);
            }
        });

        // Recipe Loading and Display
        async function loadRecipes() {
            const response = await fetch('/get_recipes');
            const recipes = await response.json();
            const recipeList = document.getElementById('recipeList');
            recipeList.innerHTML = '';
            recipes.forEach(recipe => {
                const li = document.createElement('li');
                li.textContent = recipe.name;
                li.addEventListener('click', () => showRecipeDetails(recipe));
                recipeList.appendChild(li);
            });
        }

        function showRecipeDetails(recipe) {
            const modal = document.createElement('div');
            modal.className = 'small-modal';
            modal.innerHTML = `
                <div class="small-modal-content">
                    <span class="close">&times;</span>
                    <div class="small-modal-header">
                        <img src="${recipe.image_path || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                        <div class="small-modal-title">
                            <h2>${recipe.name}</h2>
                            <div class="recipe-meta">
                                ${recipe.cuisine ? `<span>Cuisine: ${recipe.cuisine}</span>` : ''}
                                ${recipe.difficulty ? `<span>Difficulty: ${recipe.difficulty}</span>` : ''}
                                ${recipe.time ? `<span>Time: ${recipe.time} minutes</span>` : ''}
                                ${recipe.calories ? `<span>Calories: ${recipe.calories}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="small-modal-body">
                        <div class="ingredients-section">
                            <h3>Ingredients</h3>
                            <ul>
                                ${Array.isArray(recipe.ingredients) 
                                    ? recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')
                                    : `<li>${recipe.ingredients}</li>`}
                            </ul>
                        </div>
                        
                        <div class="instructions-section">
                            <h3>Instructions</h3>
                            <div class="instructions-text">
                                ${recipe.instructions.split('\n').map(step => `<p>${step}</p>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Add close functionality
            const closeBtn = modal.querySelector('.close');
            closeBtn.onclick = () => modal.remove();
            
            window.onclick = (event) => {
                if (event.target === modal) {
                    modal.remove();
                }
            };
        }

        // Shopping List Functionality
        let shoppingItems = JSON.parse(localStorage.getItem('shoppingItems')) || [];

        function updateLocalStorage() {
            localStorage.setItem('shoppingItems', JSON.stringify(shoppingItems));
        }

        function renderShoppingList() {
            const shoppingList = document.getElementById('shoppingList');
            shoppingList.innerHTML = '';
            
            shoppingItems.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = `shopping-item ${item.checked ? 'checked' : ''}`;
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = item.checked;
                checkbox.addEventListener('change', () => toggleItem(index));

                const text = document.createElement('span');
                text.className = 'shopping-item-text';
                text.textContent = item.text;

                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-item';
                deleteButton.innerHTML = '×';
                deleteButton.addEventListener('click', () => deleteItem(index));

                li.appendChild(checkbox);
                li.appendChild(text);
                li.appendChild(deleteButton);
                shoppingList.appendChild(li);
            });
        }

        function addShoppingItem() {
            const input = document.getElementById('newItem');
            const text = input.value.trim();
            
            if (text) {
                shoppingItems.push({
                    text: text,
                    checked: false
                });
                updateLocalStorage();
                renderShoppingList();
                input.value = '';
                input.focus(); // Keep focus on input for multiple additions
            }
        }

        function toggleItem(index) {
            shoppingItems[index].checked = !shoppingItems[index].checked;
            updateLocalStorage();
            renderShoppingList();
        }

        function deleteItem(index) {
            shoppingItems.splice(index, 1);
            updateLocalStorage();
            renderShoppingList();
        }

        // Add event listeners
        document.addEventListener('DOMContentLoaded', () => {
            const newItemInput = document.getElementById('newItem');
            
            // Enter key event listener
            newItemInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addShoppingItem();
                }
            });

            // Initial render of shopping list
            renderShoppingList();
        });

        // Add this to your window.onload or at the end of your script
        function loadMainPage() {
            hideAllSections();
            mainSection.classList.remove('hidden');
            loadRecipePosts();
        }

        async function loadRecipePosts() {
            const recipePosts = document.getElementById('recipePosts');
            const response = await fetch('/get_recipes');
            const recipes = await response.json();
            
            recipePosts.innerHTML = '';
            recipes.forEach(recipe => {
                const post = document.createElement('div');
                post.className = 'recipe-post';
                post.innerHTML = `
                    <img src="${recipe.photo_url || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                    <div class="recipe-post-content">
                        <h3>${recipe.name}</h3>
                        <p>${recipe.ingredients}</p>
                    </div>
                `;
                post.addEventListener('click', () => {
                    hideAllSections();
                    viewRecipesSection.classList.remove('hidden');
                    showRecipeDetails(recipe);
                });
                recipePosts.appendChild(post);
            });
        }

        async function searchRecipes() {
            const searchTerm = document.getElementById('searchInput').value;
            const recipePosts = document.getElementById('recipePosts');
            
            try {
                const response = await fetch(`/search_recipes?term=${encodeURIComponent(searchTerm)}`);
                if (!response.ok) throw new Error('Search failed');
                
                const recipes = await response.json();
                
                recipePosts.innerHTML = '';
                recipes.forEach(recipe => {
                    const post = document.createElement('div');
                    post.className = 'recipe-post';
                    post.innerHTML = `
                        <img src="${recipe.photo_url || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                        <div class="recipe-post-content">
                            <h3>${recipe.name}</h3>
                            <p>${recipe.ingredients.join(', ')}</p>
                        </div>
                    `;
                    post.addEventListener('click', () => showRecipeDetails(recipe));
                    recipePosts.appendChild(post);
                });
            } catch (error) {
                console.error('Search error:', error);
                alert('Error performing search');
            }
        }

        // Add home button functionality
        document.addEventListener('DOMContentLoaded', () => {
            hideAllSections();
            document.getElementById('mainSection').classList.remove('hidden');
        });

        // Add event listener for search input
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchRecipes();
            }
        });

        // Add this to your existing JavaScript
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            document.body.classList.toggle('sidebar-collapsed');
        });

        // Load recipes when the page loads
        document.addEventListener('DOMContentLoaded', loadRecipes);

        async function loadRecipes() {
            try {
                const response = await fetch('/get_recipes');
                if (!response.ok) throw new Error('Failed to fetch recipes');
                
                const recipes = await response.json();
                displayRecipes(recipes);
                updateFilters(recipes);
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to load recipes');
            }
        }

        function displayRecipes(recipes) {
            const recipePosts = document.getElementById('recipePosts');
            recipePosts.innerHTML = '';
            
            recipes.forEach(recipe => {
                const card = createRecipeCard(recipe);
                recipePosts.appendChild(card);
            });
        }

        function createRecipeCard(recipe) {
            const card = document.createElement('div');
            card.className = 'recipe-card';
            card.innerHTML = `
                <img src="${recipe.image_path || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                <div class="recipe-card-content">
                    <h3>${recipe.name}</h3>
                    <p>${recipe.ingredients.join(', ')}</p>
                    <div class="recipe-card-actions">
                        <button class="view-recipe-button" onclick="showRecipeDetails(${JSON.stringify(recipe)})">View Recipe</button>
                        <button class="like-button" onclick="likeRecipe('${recipe.recipe_id}')">Like</button>
                        <button class="cooked-button" onclick="cookedRecipe('${recipe.recipe_id}')">Cooked</button>
                        <button class="want-to-try-button" onclick="wantToTryRecipe('${recipe.recipe_id}')">Want to Try</button>
                    </div>
                </div>
            `;
            return card;
        }

        function openFullRecipeModal(recipe) {
            const modal = document.createElement('div');
            modal.className = 'full-recipe-modal';
            modal.innerHTML = `
                <div class="full-recipe-content">
                    <span class="close">&times;</span>
                    <div class="recipe-modal-header">
                        <img src="${recipe.image_path || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                        <div class="recipe-modal-title">
                            <h2>${recipe.name}</h2>
                            <div class="recipe-meta">
                                ${recipe.cuisine ? `<span>Cuisine: ${recipe.cuisine}</span>` : ''}
                                ${recipe.difficulty ? `<span>Difficulty: ${recipe.difficulty}</span>` : ''}
                                ${recipe.time ? `<span>Time: ${recipe.time} minutes</span>` : ''}
                                ${recipe.calories ? `<span>Calories: ${recipe.calories}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipe-modal-body">
                        <div class="ingredients-section">
                            <h3>Ingredients</h3>
                            <ul>
                                ${Array.isArray(recipe.ingredients) 
                                    ? recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')
                                    : `<li>${recipe.ingredients}</li>`}
                            </ul>
                        </div>
                        
                        <div class="instructions-section">
                            <h3>Instructions</h3>
                            <div class="instructions-text">
                                ${recipe.instructions.split('\n').map(step => `<p>${step}</p>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Add close functionality
            const closeBtn = modal.querySelector('.close');
            closeBtn.onclick = () => modal.remove();
            
            window.onclick = (event) => {
                if (event.target === modal) {
                    modal.remove();
                }
            };
        }

        function highlightStars(stars, rating) {
            stars.forEach(star => {
                if (star.getAttribute('data-value') <= rating) {
                    star.classList.add('highlighted');
                } else {
                    star.classList.remove('highlighted');
                }
            });
        }

        async function rateRecipe(recipeId, rating) {
            if (!currentUserEmail) {
                alert('Please sign in to rate recipes');
                return;
            }

            try {
                const response = await fetch(`/rate_recipe/${recipeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_email: currentUserEmail, rating: rating })
                });

                const result = await response.json();
                if (response.ok) {
                    alert('Recipe rated successfully!');
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Error rating recipe:', error);
                alert('Error rating recipe: ' + error.message);
            }
        }

        function openQuickViewModal(recipe) {
            const modal = document.createElement('div');
            modal.className = 'quick-view-modal';
            modal.innerHTML = `
                <div class="quick-view-content">
                    <span class="close">&times;</span>
                    <h3>${recipe.name}</h3>
                    <div class="quick-view-details">
                        ${recipe.cuisine ? `<p><strong>Cuisine:</strong> ${recipe.cuisine}</p>` : ''}
                        ${recipe.difficulty ? `<p><strong>Difficulty:</strong> ${recipe.difficulty}</p>` : ''}
                        ${recipe.time ? `<p><strong>Time:</strong> ${recipe.time} minutes</p>` : ''}
                    </div>
                    <div class="recipe-actions">
                        <button class="like-button" onclick="likeRecipe('${recipe.recipe_id}')">Add to Liked</button>
                        <button class="cooked-button" onclick="cookedRecipe('${recipe.recipe_id}')">Add to Cooked</button>
                        <button class="want-to-try-button" onclick="wantToTryRecipe('${recipe.recipe_id}')">Add to Want to Cook</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            const closeBtn = modal.querySelector('.close');
            closeBtn.onclick = () => modal.remove();
            
            window.onclick = (event) => {
                if (event.target === modal) {
                    modal.remove();
                }
            };
        }

        // Add search and filter functionality
        document.getElementById('searchRecipes').addEventListener('input', filterRecipes);
        document.getElementById('cuisineFilter').addEventListener('change', filterRecipes);
        document.getElementById('difficultyFilter').addEventListener('change', filterRecipes);

        async function filterRecipes() {
            const searchTerm = document.getElementById('searchRecipes').value;
            const selectedCuisine = document.getElementById('cuisineFilter').value;
            const selectedDifficulty = document.getElementById('difficultyFilter').value;

            try {
                const params = new URLSearchParams({
                    term: searchTerm,
                    cuisine: selectedCuisine,
                    difficulty: selectedDifficulty
                });
                
                const response = await fetch(`/search_recipes?${params}`);
                if (!response.ok) throw new Error('Filter failed');
                
                const recipes = await response.json();
                displayRecipes(recipes);
            } catch (error) {
                console.error('Filter error:', error);
                alert('Error applying filters');
            }
        }

        function updateFilters(recipes) {
            const cuisines = [...new Set(recipes.map(r => r.cuisine).filter(Boolean))];
            const cuisineFilter = document.getElementById('cuisineFilter');
            cuisineFilter.innerHTML = '<option value="">All Cuisines</option>';
            cuisines.forEach(cuisine => {
                cuisineFilter.innerHTML += `<option value="${cuisine}">${cuisine}</option>`;
            });
        }

        // Add debouncing to prevent too many requests
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Add event listeners with debouncing
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const searchRecipesInput = document.getElementById('searchRecipes');
            
            const debouncedSearch = debounce(searchRecipes, 300);
            const debouncedFilter = debounce(filterRecipes, 300);
            
            searchInput.addEventListener('input', debouncedSearch);
            searchRecipesInput.addEventListener('input', debouncedFilter);
            
            // Add event listeners for filters
            document.getElementById('cuisineFilter').addEventListener('change', filterRecipes);
            document.getElementById('difficultyFilter').addEventListener('change', filterRecipes);
        });

        // Global variable to store current user's email
        let currentUserEmail = null;

        // Get modal elements
        const signinModal = document.getElementById('signinModal');
        const signupModal = document.getElementById('signupModal');
        const signupButton = document.getElementById('signupButton');
        const signinButton = document.getElementById('signinButton');

        // Event listeners for opening modals
        signupButton.addEventListener('click', () => {
            signupModal.classList.add('show');
        });

        signinButton.addEventListener('click', () => {
            signinModal.classList.add('show');
        });

        // Close buttons in modals
        const closeButtons = document.getElementsByClassName('close');
        Array.from(closeButtons).forEach(button => {
            button.addEventListener('click', () => {
                signinModal.classList.remove('show');
                signupModal.classList.remove('show');
            });
        });

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === signinModal) {
                signinModal.classList.remove('show');
            }
            if (event.target === signupModal) {
                signupModal.classList.remove('show');
            }
        });

        // Handle sign in
        document.getElementById('signinForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('signinEmail').value;
            const password = document.getElementById('signinPassword').value;

            try {
                const response = await fetch('/signin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const result = await response.json();
                
                if (response.ok) {
                    currentUserEmail = email;
                    document.getElementById('profileButton').classList.remove('hidden');
                    signinModal.classList.remove('show');
                    signupButton.classList.add('hidden');
                    signinButton.classList.add('hidden');
                    alert('Signed in successfully!');
                } else {
                    alert(result.error || 'Sign in failed');
                }
            } catch (error) {
                alert('Error signing in: ' + error.message);
            }
        });

        // Handle sign up
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            try {
                const response = await fetch('/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        name,
                        email, 
                        password 
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    signupModal.classList.remove('show');
                    alert('Signed up successfully! Please sign in.');
                } else {
                    alert(result.error || 'Sign up failed');
                }
            } catch (error) {
                alert('Error signing up: ' + error.message);
            }
        });

        // Update the recipe interaction functions
        async function likeRecipe(recipeId) {
            if (!currentUserEmail) {
                alert('Please sign in to like recipes');
                return;
            }

            try {
                const response = await fetch(`/like_recipe/${recipeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_email: currentUserEmail })
                });

                const result = await response.json();
                if (response.ok) {
                    alert('Recipe liked successfully!');
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Error liking recipe:', error);
                alert('Error liking recipe: ' + error.message);
            }
        }

        async function cookedRecipe(recipeId) {
            if (!currentUserEmail) {
                alert('Please sign in to mark recipes as cooked');
                return;
            }

            try {
                const response = await fetch(`/cooked_recipe/${recipeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_email: currentUserEmail })
                });

                const result = await response.json();
                if (response.ok) {
                    alert('Recipe marked as cooked!');
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Error marking recipe as cooked:', error);
                alert('Error marking recipe as cooked: ' + error.message);
            }
        }

        async function wantToTryRecipe(recipeId) {
            if (!currentUserEmail) {
                alert('Please sign in to mark recipes as cooked');
                return;
            }

            try {
                const response = await fetch(`/want_to_try_recipe/${recipeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_email: currentUserEmail })
                });

                const result = await response.json();
                if (response.ok) {
                    alert('Recipe added to Want to Try list!');
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Error marking recipe as want to try:', error);
                alert('Error marking recipe as want to try: ' + error.message);
            }
        }

        // Add profile-related functions
        function displayUserProfile(userData) {
            const userInfoDisplay = document.getElementById('userInfoDisplay');
            userInfoDisplay.innerHTML = `
                <p><strong>Name:</strong> ${userData.name}</p>
                <p><strong>Age:</strong> ${userData.age} years</p>
                <p><strong>Height:</strong> ${userData.height} cm</p>
                <p><strong>Weight:</strong> ${userData.weight} kg</p>
                <p><strong>Goal:</strong> ${userData.goal.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>
            `;
        }

        async function loadUserProfile() {
            if (!currentUserEmail) {
                console.log('No user is currently signed in');
                return;
            }

            try {
                const response = await fetch(`/get_user_profile?user_email=${currentUserEmail}`);
                const userData = await response.json();
                
                if (!response.ok) {
                    throw new Error(userData.error || 'Failed to load profile');
                }

                // Set default values for missing data
                const defaultData = {
                    name: 'Not set',
                    age: '',
                    height: '',
                    weight: '',
                    goal: 'maintain_weight'
                };

                // Merge received data with defaults
                const displayData = { ...defaultData, ...userData };
                
                displayUserProfile(displayData);
                
                // Populate the form fields
                document.getElementById('userName').value = displayData.name;
                document.getElementById('userAge').value = displayData.age;
                document.getElementById('userHeight').value = displayData.height;
                document.getElementById('userWeight').value = displayData.weight;
                document.getElementById('userGoal').value = displayData.goal;
                
            } catch (error) {
                console.error('Error loading profile:', error);
                // Don't show alert for profile loading errors, just log them
                displayUserProfile({
                    name: 'Not set',
                    age: '',
                    height: '',
                    weight: '',
                    goal: 'maintain_weight'
                });
            }
        }

        // Add event listeners
        document.getElementById('editProfileBtn').addEventListener('click', () => {
            document.getElementById('profileForm').classList.remove('hidden');
            document.getElementById('userInfoDisplay').classList.add('hidden');
            document.getElementById('editProfileBtn').classList.add('hidden');
        });

        document.getElementById('cancelEditBtn').addEventListener('click', () => {
            document.getElementById('profileForm').classList.add('hidden');
            document.getElementById('userInfoDisplay').classList.remove('hidden');
            document.getElementById('editProfileBtn').classList.remove('hidden');
        });

        document.getElementById('userProfileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const profileData = {
                user_email: currentUserEmail,
                name: document.getElementById('userName').value,
                age: document.getElementById('userAge').value,
                height: document.getElementById('userHeight').value,
                weight: document.getElementById('userWeight').value,
                goal: document.getElementById('userGoal').value
            };

            try {
                const response = await fetch('/update_user_profile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(profileData)
                });

                if (!response.ok) throw new Error('Failed to update profile');

                alert('Profile updated successfully!');
                document.getElementById('profileForm').classList.add('hidden');
                document.getElementById('userInfoDisplay').classList.remove('hidden');
                document.getElementById('editProfileBtn').classList.remove('hidden');
                
                // Reload the profile display
                loadUserProfile();
            } catch (error) {
                console.error('Error updating profile:', error);
                alert('Error updating profile');
            }
        });

        // Load profile when the profile section is shown
        document.getElementById('profileButton').addEventListener('click', () => {
            loadUserProfile();
        });

        // Update the recipe list loading functions
        async function loadUserRecipes(type) {
            if (!currentUserEmail) {
                alert('Please sign in to view your recipes');
                return;
            }

            try {
                console.log(`Loading ${type} recipes for user: ${currentUserEmail}`); // Debug log
                const response = await fetch(`/get_user_recipes/${type}?user_email=${currentUserEmail}`);
                
                if (!response.ok) {
                    throw new Error(`Failed to load ${type} recipes`);
                }
                
                const recipes = await response.json();
                console.log(`Received recipes:`, recipes); // Debug log
                
                // Get the correct container
                const containerId = `${type}RecipesSection`;
                const container = document.getElementById(containerId);
                
                if (!container) {
                    console.error(`Container ${containerId} not found`);
                    return;
                }

                // Clear the container
                container.innerHTML = `
                    <h3>${type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())} Recipes</h3>
                    <div class="recipe-grid"></div>
                `;

                const recipeGrid = container.querySelector('.recipe-grid');

                if (!recipes || recipes.length === 0) {
                    recipeGrid.innerHTML = `
                        <div class="empty-state">
                            <p>No ${type.replace(/_/g, ' ')} recipes yet</p>
                        </div>
                    `;
                    return;
                }

                // Display each recipe
                recipes.forEach(recipe => {
                    const recipeCard = createRecipeCard(recipe);
                    recipeGrid.appendChild(recipeCard);
                });

            } catch (error) {
                console.error(`Error loading ${type} recipes:`, error);
                alert(`Error loading ${type} recipes: ${error.message}`);
            }
        }

        // Update the event listener for the Want to Try button
        document.addEventListener('DOMContentLoaded', () => {
            const wantToTryButton = document.getElementById('wantToTryRecipesButton');
            
            wantToTryButton.addEventListener('click', () => {
                console.log('Want to Try button clicked'); // Debug log
                hideAllRecipeSections();
                const wantToTrySection = document.getElementById('wantToTryRecipesSection');
                wantToTrySection.classList.remove('hidden');
                loadUserRecipes('want_to_try');
            });
        });

        // Make sure this HTML structure exists
        const recipeListsHtml = `
        <div id="wantToTryRecipesSection" class="recipe-section hidden">
            <h3>Want to Try Recipes</h3>
            <div class="recipe-grid"></div>
        </div>
        `;

        // Add these styles if not already present
        const styles = `
        <style>
            .recipe-section {
                margin: 20px 0;
            }

            .recipe-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
                padding: 20px 0;
            }

            .recipe-card {
                background: white;
            border-radius: 8px;
                overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                transition: transform 0.2s;
            }

            .recipe-card:hover {
                transform: translateY(-5px);
            }

            .recipe-card img {
                width: 100%;
                height: 200px;
                object-fit: cover;
            }

            .recipe-card-content {
                padding: 15px;
            }

            .recipe-card h4 {
                margin: 0 0 10px 0;
                color: #2c3e50;
            }

            .empty-state {
                text-align: center;
                padding: 20px;
                color: #666;
            }

            .hidden {
                display: none;
            }
        </style>
        `;

        // Update the hideAllRecipeSections function
        function hideAllRecipeSections() {
            const sections = [
                'likedRecipesSection',
                'cookedRecipesSection',
                'wantToTryRecipesSection',
                'addedRecipesSection'  // Add this line
            ];
            
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.add('hidden');
                }
            });
        }

        // Add the recipe modal function
        function openRecipeModal(recipe) {
            const modal = document.createElement('div');
            modal.className = 'recipe-modal';
            modal.innerHTML = `
                <div class="recipe-modal-content">
                    <span class="close">&times;</span>
                    <div class="recipe-modal-header">
                        <img src="${recipe.image_path || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                        <div class="recipe-modal-title">
                            <h2>${recipe.name}</h2>
                            <div class="recipe-meta">
                                ${recipe.cuisine ? `<span>Cuisine: ${recipe.cuisine}</span>` : ''}
                                ${recipe.difficulty ? `<span>Difficulty: ${recipe.difficulty}</span>` : ''}
                                ${recipe.time ? `<span>Time: ${recipe.time} minutes</span>` : ''}
                                ${recipe.calories ? `<span>Calories: ${recipe.calories}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipe-modal-body">
                        <div class="ingredients-section">
                            <h3>Ingredients</h3>
                            <ul>
                                ${Array.isArray(recipe.ingredients) 
                                    ? recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')
                                    : `<li>${recipe.ingredients}</li>`}
                            </ul>
                        </div>
                        
                        <div class="instructions-section">
                            <h3>Instructions</h3>
                            <div class="instructions-text">
                                ${recipe.instructions.split('\n').map(step => `<p>${step}</p>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Add close functionality
            const closeBtn = modal.querySelector('.close');
            closeBtn.onclick = () => modal.remove();
            
            window.onclick = (event) => {
                if (event.target === modal) {
                    modal.remove();
                }
            };
        }

        // Update the recipe card click handler for all recipes
        function createRecipeCard(recipe) {
            const card = document.createElement('div');
            card.className = 'recipe-card';
            card.dataset.recipeId = recipe.recipe_id; // Add data attribute for recipe ID
            card.innerHTML = `
                <img src="${recipe.image_path || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                <div class="recipe-card-content">
                    <h4>${recipe.name}</h4>
                    ${recipe.cuisine ? `<p>Cuisine: ${recipe.cuisine}</p>` : ''}
                    ${recipe.difficulty ? `<p>Difficulty: ${recipe.difficulty}</p>` : ''}
                    <button class="view-details-btn">View Details</button>
                </div>
            `;

            // Add click handler for the entire card except the "View Details" button
            card.addEventListener('click', (e) => {
                // If the clicked element is not the "View Details" button, open full modal
                if (!e.target.classList.contains('view-details-btn')) {
                    openFullRecipeModal(recipe);
                }
            });

            // Add click handler for the "View Details" button
            const viewDetailsBtn = card.querySelector('.view-details-btn');
            viewDetailsBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent triggering the card click event
                openQuickViewModal(recipe);
            });

            return card;
        }

        // Quick view modal for "View Details" button
        function openQuickViewModal(recipe) {
            const modal = document.createElement('div');
            modal.className = 'quick-view-modal';
            modal.innerHTML = `
                <div class="quick-view-content">
                    <span class="close">&times;</span>
                    <h3>${recipe.name}</h3>
                    <div class="quick-view-details">
                        ${recipe.cuisine ? `<p><strong>Cuisine:</strong> ${recipe.cuisine}</p>` : ''}
                        ${recipe.difficulty ? `<p><strong>Difficulty:</strong> ${recipe.difficulty}</p>` : ''}
                        ${recipe.time ? `<p><strong>Time:</strong> ${recipe.time} minutes</p>` : ''}
                    </div>
                    <div class="recipe-actions">
                        <button class="like-button" onclick="likeRecipe('${recipe.recipe_id}')">Add to Liked</button>
                        <button class="cooked-button" onclick="cookedRecipe('${recipe.recipe_id}')">Add to Cooked</button>
                        <button class="want-to-try-button" onclick="wantToTryRecipe('${recipe.recipe_id}')">Add to Want to Cook</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            const closeBtn = modal.querySelector('.close');
            closeBtn.onclick = () => modal.remove();
            
            window.onclick = (event) => {
                if (event.target === modal) {
                    modal.remove();
                }
            };
        }

        // Full recipe modal for card/image click
        function openFullRecipeModal(recipe) {
            const modal = document.createElement('div');
            modal.className = 'full-recipe-modal';
            modal.innerHTML = `
                <div class="full-recipe-content">
                    <span class="close">&times;</span>
                    <div class="recipe-modal-header">
                        <img src="${recipe.image_path || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                        <div class="recipe-modal-title">
                            <h2>${recipe.name}</h2>
                            <div class="recipe-meta">
                                ${recipe.cuisine ? `<span>Cuisine: ${recipe.cuisine}</span>` : ''}
                                ${recipe.difficulty ? `<span>Difficulty: ${recipe.difficulty}</span>` : ''}
                                ${recipe.time ? `<span>Time: ${recipe.time} minutes</span>` : ''}
                                ${recipe.calories ? `<span>Calories: ${recipe.calories}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipe-modal-body">
                        <div class="ingredients-section">
                            <h3>Ingredients</h3>
                            <ul>
                                ${Array.isArray(recipe.ingredients) 
                                    ? recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')
                                    : `<li>${recipe.ingredients}</li>`}
                            </ul>
                        </div>
                        
                        <div class="instructions-section">
                            <h3>Instructions</h3>
                            <div class="instructions-text">
                                ${recipe.instructions.split('\n').map(step => `<p>${step}</p>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            const closeBtn = modal.querySelector('.close');
            closeBtn.onclick = () => modal.remove();
            
            window.onclick = (event) => {
                if (event.target === modal) {
                    modal.remove();
                }
            };
        }

        // Add this to your existing script section
        document.getElementById('calorieCalculatorForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent form submission

            // Get form values
            const sex = document.getElementById('sex').value;
            const age = parseInt(document.getElementById('age').value);
            const height = parseInt(document.getElementById('height').value);
            const weight = parseInt(document.getElementById('weight').value);
            const activityLevel = document.getElementById('activityLevel').value;
            const goal = document.getElementById('goal').value;

            // Calculate BMR using Mifflin-St Jeor Equation
            let bmr;
            if (sex === 'male') {
                bmr = 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                bmr = 10 * weight + 6.25 * height - 5 * age - 161;
            }

            // Apply activity multiplier
            let tdee;
            switch (activityLevel) {
                case 'sedentary':
                    tdee = bmr * 1.2;
                    break;
                case 'light':
                    tdee = bmr * 1.375;
                    break;
                case 'moderate':
                    tdee = bmr * 1.55;
                    break;
                case 'active':
                    tdee = bmr * 1.725;
                    break;
                case 'veryActive':
                    tdee = bmr * 1.9;
                    break;
                default:
                    tdee = bmr * 1.2;
            }

            // Adjust for goal
            let finalCalories;
            switch (goal) {
                case 'lose':
                    finalCalories = tdee - 500; // Create a 500 calorie deficit
                    break;
                case 'gain':
                    finalCalories = tdee + 500; // Create a 500 calorie surplus
                    break;
                default:
                    finalCalories = tdee; // Maintain weight
            }

            // Display result
            const resultDiv = document.getElementById('calorieResult');
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = `
                <h3>Your Daily Caloric Needs:</h3>
                <p>Base Metabolic Rate (BMR): ${Math.round(bmr)} calories</p>
                <p>Total Daily Energy Expenditure (TDEE): ${Math.round(tdee)} calories</p>
                <p>Recommended Daily Calories: ${Math.round(finalCalories)} calories</p>
                <p class="result-explanation">
                    ${getGoalExplanation(goal, Math.round(finalCalories))}
                </p>
            `;
        });

        // Add this helper function for the explanation
        function getGoalExplanation(goal, calories) {
            switch (goal) {
                case 'lose':
                    return `This represents a 500-calorie daily deficit, which should result in about 1 pound of weight loss per week.`;
                case 'gain':
                    return `This represents a 500-calorie daily surplus, which should result in about 1 pound of weight gain per week.`;
                default:
                    return `This amount of calories should maintain your current weight.`;
            }
        }

        // Update the analyze button click handler
        document.getElementById('analyzeButton').addEventListener('click', async function() {
            const button = this;
            const buttonContent = button.querySelector('.button-content');
            const buttonLoading = button.querySelector('.button-loading');
            const resultDiv = document.getElementById('analysisResult');
            const predictionsListDiv = document.getElementById('predictionsList');
            const relatedRecipesDiv = document.getElementById('relatedRecipes');
            const recipeResultsDiv = document.getElementById('recipeResults');
            
            const fileInput = document.getElementById('productImageInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select an image first');
                return;
            }
            
            // Show loading state
            button.disabled = true;
            buttonContent.classList.add('hidden');
            buttonLoading.classList.remove('hidden');
            
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                // Get AI analysis
                const response = await fetch('/analyze_image', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                // Show success state
                button.classList.add('success');
                resultDiv.classList.add('show');
                
                // Display predictions
                predictionsListDiv.innerHTML = result.predictions.map(pred => `
                    <div class="prediction-item">
                        <div class="prediction-content">
                            <div class="prediction-label">${pred.product}</div>
                            <div class="probability-bar">
                                <div class="probability-fill" style="width: ${pred.probability * 100}%"></div>
                            </div>
                            <div class="prediction-probability">${(pred.probability * 100).toFixed(1)}% confidence</div>
                        </div>
                        <button class="find-recipes-btn" onclick="findRecipesWithIngredient('${pred.product}')">
                            Find Recipes
                        </button>
                    </div>
                `).join('');
                
                // Reset button after 2 seconds
                setTimeout(() => {
                    button.classList.remove('success');
                    button.disabled = false;
                    buttonContent.classList.remove('hidden');
                    buttonLoading.classList.add('hidden');
                }, 2000);
                
            } catch (error) {
                // ... existing error handling ...
            }
        });

        // Add this new function to search for recipes with detected ingredient
        async function findRecipesWithIngredient(ingredient) {
            const relatedRecipesDiv = document.getElementById('relatedRecipes');
            const recipeResultsDiv = document.getElementById('recipeResults');
            
            try {
                const response = await fetch(`/search_recipes_by_ingredient?ingredient=${encodeURIComponent(ingredient)}`);
                const recipes = await response.json();
                
                if (recipes.length === 0) {
                    recipeResultsDiv.innerHTML = `
                        <div class="no-results">
                            <p>No recipes found with ${ingredient}</p>
                        </div>`;
                } else {
                    recipeResultsDiv.innerHTML = recipes.map(recipe => `
                        <div class="recipe-result">
                            <img src="${recipe.image_path || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                            <h3>${recipe.name}</h3>
                            
                            <div>Cuisine: ${recipe.cuisine || 'Unknown'}</div>
                            <div>Difficulty: ${recipe.difficulty || 'medium'}</div>
                            <div>Time: ${recipe.time || '0'} mins</div>
                            
                            <div class="key-ingredients">
                                <h4>Key Ingredients:</h4>
                                <p>${recipe.ingredients}</p>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="like" onclick="likeRecipe('${recipe.recipe_id}')">Like</button>
                                <button class="want-to-try" onclick="wantToTryRecipe('${recipe.recipe_id}')">Want to Try</button>
                                <button class="cooked" onclick="cookedRecipe('${recipe.recipe_id}')">Cooked</button>
                            </div>
                            
                            <button class="view-full-recipe" onclick="viewFullRecipe('${recipe.recipe_id}')">
                                View Full Recipe
                            </button>
                        </div>
                    `).join('');
                }
                
                relatedRecipesDiv.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error:', error);
                recipeResultsDiv.innerHTML = '<p>Error finding recipes. Please try again.</p>';
            }
        }

        // Make sure this function exists to handle recipe details display
        function showRecipeDetails(recipeId) {
            // Fetch and display full recipe details
            fetch(`/get_recipe/${recipeId}`)
                .then(response => response.json())
                .then(recipe => {
                    const modal = document.createElement('div');
                    modal.className = 'recipe-modal';
                    modal.innerHTML = `
                        <div class="recipe-modal-content">
                            <span class="close">&times;</span>
                            <h2>${recipe.name}</h2>
                            <img src="${recipe.image_path || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                            <div class="recipe-details">
                                <div class="recipe-meta">
                                    <span>Cuisine: ${recipe.cuisine || 'Unknown'}</span>
                                    <span>Difficulty: ${recipe.difficulty || 'Unknown'}</span>
                                    <span>Time: ${recipe.time || 0} mins</span>
                                    <span>Calories: ${recipe.calories || 'N/A'}</span>
                                </div>
                                <h3>Ingredients:</h3>
                                <ul>
                                    ${recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}
                                </ul>
                                <h3>Instructions:</h3>
                                <div class="instructions">
                                    ${recipe.instructions.split('\n').map(step => `<p>${step}</p>`).join('')}
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    const closeBtn = modal.querySelector('.close');
                    closeBtn.onclick = () => modal.remove();
                    
                    window.onclick = (event) => {
                        if (event.target === modal) {
                            modal.remove();
                        }
                    };
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error loading recipe details');
                });
        }

        // Add these helper functions if they don't exist
        async function likeRecipe(recipeId) {
            if (!currentUserEmail) {
                alert('Please sign in to like recipes');
                return;
            }
            try {
                const response = await fetch(`/like_recipe/${recipeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_email: currentUserEmail })
                });
                const result = await response.json();
                if (response.ok) {
                    alert(result.message);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function wantToTryRecipe(recipeId) {
            if (!currentUserEmail) {
                alert('Please sign in to add recipes to your Want to Try list');
                return;
            }
            try {
                const response = await fetch(`/want_to_try_recipe/${recipeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_email: currentUserEmail })
                });
                const result = await response.json();
                if (response.ok) {
                    alert(result.message);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function cookedRecipe(recipeId) {
            if (!currentUserEmail) {
                alert('Please sign in to mark recipes as cooked');
                return;
            }
            try {
                const response = await fetch(`/cooked_recipe/${recipeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_email: currentUserEmail })
                });
                const result = await response.json();
                if (response.ok) {
                    alert(result.message);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Add this to your existing JavaScript section
        const addedRecipesButton = document.createElement('button');
        addedRecipesButton.id = 'addedRecipesButton';
        addedRecipesButton.textContent = 'Added Recipes';
        document.getElementById('recipeOptions').appendChild(addedRecipesButton);

        // Add event listener for the new button
        addedRecipesButton.addEventListener('click', () => {
            console.log('Added Recipes button clicked'); // Debug log
            hideAllRecipeSections();
            document.getElementById('addedRecipesSection').classList.remove('hidden');
            loadUserRecipes('added');
        });

        // Update the recipe form submission to include user email
        document.getElementById('recipeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            formData.append('user_email', currentUserEmail); // Add user email to form data
            
            try {
                const response = await fetch('/add_recipe', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    alert('Recipe added successfully!');
                    e.target.reset();
                } else {
                    alert(result.error || 'Error adding recipe');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

       

        // Add these functions to handle recipe actions
        async function likeRecipe(recipeId) {
            if (!currentUserEmail) {
                alert('Please sign in to like recipes');
                return;
            }
            try {
                const response = await fetch(`/like_recipe/${recipeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_email: currentUserEmail })
                });
                const result = await response.json();
                if (response.ok) {
                    alert(result.message);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Similar functions for cookedRecipe and wantToTryRecipe...

        function openFullRecipeModal(recipe) {
            const modal = document.createElement('div');
            modal.className = 'full-recipe-modal';
            modal.innerHTML = `
                <div class="full-recipe-content">
                    <span class="close">&times;</span>
                    <div class="recipe-modal-header">
                        <img src="${recipe.image_path || '/static/default-recipe.jpg'}" alt="${recipe.name}">
                        <div class="recipe-modal-title">
                            <h2>${recipe.name}</h2>
                            <div class="recipe-meta">
                                ${recipe.cuisine ? `<span>Cuisine: ${recipe.cuisine}</span>` : ''}
                                ${recipe.difficulty ? `<span>Difficulty: ${recipe.difficulty}</span>` : ''}
                                ${recipe.time ? `<span>Time: ${recipe.time} minutes</span>` : ''}
                                ${recipe.calories ? `<span>Calories: ${recipe.calories}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipe-modal-body">
                        <div class="ingredients-section">
                            <h3>Ingredients</h3>
                            <ul>
                                ${Array.isArray(recipe.ingredients) 
                                    ? recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')
                                    : `<li>${recipe.ingredients}</li>`}
                            </ul>
                        </div>
                        
                        <div class="instructions-section">
                            <h3>Instructions</h3>
                            <div class="instructions-text">
                                ${recipe.instructions.split('\n').map(step => `<p>${step}</p>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Add close functionality
            const closeBtn = modal.querySelector('.close');
            closeBtn.onclick = () => modal.remove();
            
            window.onclick = (event) => {
                if (event.target === modal) {
                    modal.remove();
                }
            };
        }

        document.querySelectorAll('.view-details-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent triggering other click events
                const recipeId = e.target.closest('.recipe-card').dataset.recipeId;
                openQuickViewModal(recipeId);
            });
        });

        // Update the Want to Try button click handler
        document.getElementById('wantToTryRecipesButton').addEventListener('click', async () => {
            console.log('Want to Try button clicked');
            if (!currentUserEmail) {
                alert('Please sign in to view your Want to Try recipes');
                return;
            }

            try {
                hideAllRecipeSections();
                const wantToTrySection = document.getElementById('wantToTryRecipesSection');
                if (!wantToTrySection) {
                    console.error('Want to Try section not found in DOM');
                    return;
                }
                
                wantToTrySection.classList.remove('hidden');
                
                // Fetch the recipes
                const response = await fetch(`/get_user_recipes/want_to_try?user_email=${currentUserEmail}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch Want to Try recipes');
                }
                
                const recipes = await response.json();
                console.log('Fetched Want to Try recipes:', recipes);

                // Clear and update the recipe grid
                const recipeGrid = wantToTrySection.querySelector('.recipe-grid');
                if (!recipeGrid) {
                    console.error('Recipe grid not found in Want to Try section');
                    return;
                }
                
                recipeGrid.innerHTML = '';

                if (recipes.length === 0) {
                    recipeGrid.innerHTML = '<div class="empty-state"><p>No recipes in your Want to Try list yet</p></div>';
                    return;
                }

                // Create and append recipe cards
                recipes.forEach(recipe => {
                    const recipeCard = createRecipeCard(recipe);
                    recipeGrid.appendChild(recipeCard);
                });

            } catch (error) {
                console.error('Error loading Want to Try recipes:', error);
                alert('Error loading Want to Try recipes. Please try again.');
            }
        });

        // Make sure this HTML structure exists at the appropriate place in your document
        if (!document.getElementById('wantToTryRecipesSection')) {
            const mainContent = document.getElementById('content');  // or whatever your main container is
            const wantToTrySection = document.createElement('div');
            wantToTrySection.id = 'wantToTryRecipesSection';
            wantToTrySection.className = 'recipe-section hidden';
            wantToTrySection.innerHTML = `
                <h3>Want to Try Recipes</h3>
                <div class="recipe-grid"></div>
            `;
            mainContent.appendChild(wantToTrySection);
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize the main search functionality
            initializeMainSearch();
            
            // Add form submit event listener
            const mainSearchForm = document.getElementById('mainSearchForm');
            mainSearchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                searchRecipes();
            });
            
            // Add event listeners for filter changes
            document.getElementById('mainSortSelect').addEventListener('change', searchRecipes);
            document.getElementById('mainCuisineFilter').addEventListener('change', searchRecipes);
            document.getElementById('mainDifficultyFilter').addEventListener('change', searchRecipes);
        });

        async function initializeMainSearch() {
            try {
                // Fetch all recipes to populate cuisine filter
                const response = await fetch('/get_recipes');
                const recipes = await response.json();
                
                // Populate cuisine filter with unique cuisines
                const cuisines = [...new Set(recipes.map(recipe => recipe.cuisine).filter(Boolean))];
                const cuisineSelect = document.getElementById('mainCuisineFilter');
                cuisines.forEach(cuisine => {
                    const option = document.createElement('option');
                    option.value = cuisine;
                    option.textContent = cuisine;
                    cuisineSelect.appendChild(option);
                });
                
                // Display initial recipes
                displayRecipes(recipes);
            } catch (error) {
                console.error('Error initializing main search:', error);
            }
        }

        async function searchRecipes() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const sortBy = document.getElementById('mainSortSelect').value;
            const cuisineFilter = document.getElementById('mainCuisineFilter').value;
            const difficultyFilter = document.getElementById('mainDifficultyFilter').value;
            
            try {
                // Fetch all recipes
                const response = await fetch('/get_recipes');
                let recipes = await response.json();
                
                // Apply filters
                recipes = recipes.filter(recipe => {
                    const matchesSearch = recipe.name.toLowerCase().includes(searchTerm) ||
                                        (recipe.ingredients && recipe.ingredients.some(ing => 
                                            ing.toLowerCase().includes(searchTerm)));
                    const matchesCuisine = !cuisineFilter || recipe.cuisine === cuisineFilter;
                    const matchesDifficulty = !difficultyFilter || recipe.difficulty === difficultyFilter;
                    
                    return matchesSearch && matchesCuisine && matchesDifficulty;
                });
                
                // Apply sorting
                if (sortBy) {
                    recipes.sort((a, b) => {
                        if (sortBy === 'name') return a.name.localeCompare(b.name);
                        if (sortBy === 'difficulty') return a.difficulty.localeCompare(b.difficulty);
                        if (sortBy === 'time') return (a.time || 0) - (b.time || 0);
                        if (sortBy === 'calories') return (a.calories || 0) - (b.calories || 0);
                        return 0;
                    });
                }
                
                // Display filtered and sorted recipes
                const recipePosts = document.getElementById('recipePosts');
                recipePosts.innerHTML = '';
                
                if (recipes.length === 0) {
                    recipePosts.innerHTML = '<div class="empty-state"><p>No recipes found</p></div>';
                    return;
                }
                
                recipes.forEach(recipe => {
                    const card = createRecipeCard(recipe);
                    recipePosts.appendChild(card);
                });
            } catch (error) {
                console.error('Error searching recipes:', error);
                alert('Error searching recipes');
            }
        }

        // You can remove the search functionality from the viewRecipesSection since it's now in the main section

        // Add these functions to your existing JavaScript

        // Initialize fridge data structure
        let fridgeItems = [];

        // Function to add item to fridge
        async function addToFridge(item = null) {
            if (!currentUserEmail) {
                alert('Please sign in to use the fridge feature');
                return;
            }

            try {
                let ingredientName, expiryDate;

                if (item) {
                    // Item comes from shopping list
                    ingredientName = item;
                    // Set expiry date to 7 days from now by default
                    const date = new Date();
                    date.setDate(date.getDate() + 7);
                    expiryDate = date.toISOString().split('T')[0];
                } else {
                    // Manual addition
                    ingredientName = document.getElementById('ingredientName').value;
                    expiryDate = document.getElementById('expiryDate').value;

                    if (!ingredientName || !expiryDate) {
                        alert('Please fill in both ingredient name and expiry date');
                        return;
                    }
                }

                const response = await fetch('/add_to_fridge', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_email: currentUserEmail,
                        ingredient: ingredientName,
                        expiry_date: expiryDate
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to add ingredient');
                }

                const result = await response.json();
                
                // Clear input fields if it was a manual addition
                if (!item) {
                    document.getElementById('ingredientName').value = '';
                    document.getElementById('expiryDate').value = '';
                }

                // Add the new item to the fridgeItems array
                if (result.item) {
                    fridgeItems.push(result.item);
                    // Immediately update the display
                    displayFridgeItems();
                }
                
            } catch (error) {
                console.error('Error:', error);
                alert(error.message);
            }
        }

        // Function to load fridge items
        async function loadFridgeItems() {
            if (!currentUserEmail) return;

            try {
                const response = await fetch(`/get_user_fridge?user_email=${currentUserEmail}`);
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to load fridge items');
                }
                
                fridgeItems = await response.json();
                console.log('Loaded fridge items:', fridgeItems); // Debug log
                displayFridgeItems();
                
                // Load recipe recommendations after updating fridge items
                await loadRecipeRecommendations();
                
            } catch (error) {
                console.error('Error loading fridge items:', error);
            }
        }

        // Function to display fridge items
        function displayFridgeItems() {
            const freshContainer = document.getElementById('freshIngredients');
            const expiringSoonContainer = document.getElementById('expiringSoonIngredients');
            const expiredContainer = document.getElementById('expiredIngredients');

            // Clear all containers
            freshContainer.innerHTML = '';
            expiringSoonContainer.innerHTML = '';
            expiredContainer.innerHTML = '';

            const today = new Date();

            fridgeItems.forEach(item => {
                try {
                    const expiryDate = new Date(item.expiry_date);
                    const daysUntilExpiry = Math.floor((expiryDate - today) / (1000 * 60 * 60 * 24));
                    
                    const itemElement = createIngredientElement(item, daysUntilExpiry);

                    if (daysUntilExpiry < 0) {
                        expiredContainer.appendChild(itemElement);
                    } else if (daysUntilExpiry <= 7) {
                        expiringSoonContainer.appendChild(itemElement);
                    } else {
                        freshContainer.appendChild(itemElement);
                    }
                } catch (error) {
                    console.error('Error displaying item:', item, error);
                }
            });
        }

        // Function to create ingredient element
        function createIngredientElement(item, daysUntilExpiry) {
            const div = document.createElement('div');
            div.className = `ingredient-item ${daysUntilExpiry < 0 ? 'expired' : daysUntilExpiry <= 7 ? 'expiring-soon' : ''}`;
            
            // Add null checks and default values
            const ingredientName = item.ingredient || 'Unknown';
            const amount = item.amount || 0;
            const unit = item.unit || '';
            const category = item.category || 'Uncategorized';
            const expiryDate = item.expiry_date || '';
            
            div.innerHTML = `
                <div class="ingredient-info">
                    <div class="ingredient-name">${ingredientName}</div>
                    <div class="ingredient-details">${amount} ${unit}</div>
                    <div class="ingredient-details">${category}</div>
                    <div class="expiry-date">${formatDate(expiryDate)}</div>
                </div>
                <button class="delete-ingredient" onclick="deleteIngredient('${item.id}')">🗑️</button>
            `;
            
            return div;
        }

        // Function to remove item from fridge
        async function removeFromFridge(itemId) {
            try {
                const response = await fetch(`/remove_from_fridge/${itemId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_email: currentUserEmail
                    })
                });

                if (!response.ok) throw new Error('Failed to remove ingredient');

                // Remove item from local array
                fridgeItems = fridgeItems.filter(item => item.id !== itemId);
                // Update display immediately
                displayFridgeItems();
                
            } catch (error) {
                console.error('Error removing from fridge:', error);
                alert('Failed to remove ingredient from fridge');
            }
        }

        // Update the shopping list checkbox handler to move items to fridge
        function toggleShoppingItem(checkbox) {
            const itemText = checkbox.nextElementSibling.textContent;
            
            if (checkbox.checked) {
                // Ask user if they want to move the item to the fridge
                if (confirm(`Would you like to move "${itemText}" to your fridge?`)) {
                    addToFridge(itemText);
                    // Remove item from shopping list
                    checkbox.parentElement.remove();
                    saveShoppingList();
                } else {
                    // If user doesn't want to move to fridge, just mark as checked
                    checkbox.parentElement.classList.add('checked');
                    saveShoppingList();
                }
            } else {
                checkbox.parentElement.classList.remove('checked');
                saveShoppingList();
            }
        }

        // Add search functionality
        document.getElementById('fridgeSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const ingredientItems = document.querySelectorAll('.ingredient-item');
            
            ingredientItems.forEach(item => {
                const ingredientName = item.querySelector('.ingredient-name').textContent.toLowerCase();
                if (ingredientName.includes(searchTerm)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // Add this to your existing JavaScript section
        document.addEventListener('DOMContentLoaded', function() {
            // Existing event listeners...

            // Add event listener for My Fridge button
            document.getElementById('myFridgeButton').addEventListener('click', function() {
                console.log('My Fridge button clicked'); // Debug log
                if (!currentUserEmail) {
                    alert('Please sign in to access your fridge');
                    return;
                }
                
                // Hide all sections
                hideAllSections();
                
                // Show fridge section
                const fridgeSection = document.getElementById('myFridgeSection');
                if (fridgeSection) {
                    fridgeSection.classList.remove('hidden');
                    // Load fridge items when showing the section
                    loadFridgeItems();
                } else {
                    console.error('Fridge section not found');
                }
                
                // Hide the profile options dropdown
                document.getElementById('profileOptions').classList.add('hidden');
            });
        });

        // Make sure hideAllSections includes the fridge section
        function hideAllSections() {
            const sections = [
                'mainSection',
                'addRecipeSection',
                'viewRecipesSection',
                'calorieCalculatorSection',
                'aiCulinarSection',
                'profileSection',
                'myFridgeSection', // Add this line
                'shoppingListSection',
                'likedRecipesSection',
                'cookedRecipesSection',
                'wantToTryRecipesSection',
                'addedRecipesSection',
                'recipeRecommendationsSection' // Add this line
            ];
            
            sections.forEach(section => {
                const element = document.getElementById(section);
                if (element) {
                    element.classList.add('hidden');
                }
            });
        }

        // Add this to your JavaScript
        async function loadRecipeRecommendations() {
            if (!currentUserEmail) return;

            try {
                const response = await fetch(`/get_recipe_recommendations?user_email=${currentUserEmail}`);
                if (!response.ok) throw new Error('Failed to load recommendations');
                
                const recipes = await response.json();
                displayRecipeRecommendations(recipes);
            } catch (error) {
                console.error('Error loading recommendations:', error);
                document.getElementById('recipeRecommendations').innerHTML = 
                    '<p class="error-message">Failed to load recipe recommendations. Please try again later.</p>';
            }
        }

        function displayRecipeRecommendations(recipes) {
            const container = document.getElementById('recipeRecommendations');
            container.innerHTML = '';

            if (recipes.length === 0) {
                container.innerHTML = '<p>No recipe recommendations available. Try updating your preferences!</p>';
                return;
            }

            recipes.forEach(recipe => {
                const card = document.createElement('div');
                card.className = 'recipe-card';
                
                card.innerHTML = `
                    <div class="recipe-header">
                        <div class="recipe-title">${recipe.name}</div>
                        <div class="match-percentage">${Math.round(recipe.match_percentage)}% match</div>
                    </div>
                    <div class="recipe-details">
                        <div class="recipe-ingredients">
                            <strong>Ingredients:</strong><br>
                            ${recipe.ingredients.map(ing => `<span>${ing}</span>`).join(' ')}
                        </div>
                        <div class="recipe-stats">
                            <span>🕒 ${recipe.time} mins</span>
                            <span>🔥 ${recipe.calories} cal</span>
                            <span>📊 ${recipe.difficulty}</span>
                        </div>
                    </div>
                    <button onclick="viewRecipeDetails('${recipe.recipe_id}')" class="view-recipe-btn">View Recipe</button>
                `;
                
                container.appendChild(card);
            });
        }

        // Add this function to handle viewing recipe details
        async function viewRecipeDetails(recipeId) {
            try {
                const response = await fetch(`/get_recipe/${recipeId}`);
                if (!response.ok) throw new Error('Failed to load recipe details');
                
                const recipe = await response.json();
                
                // Create and show modal with recipe details
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'block';
                
                modal.innerHTML = `
                    <div class="modal-content recipe-detail-modal">
                        <span class="close">&times;</span>
                        <h2>${recipe.name}</h2>
                        
                        ${recipe.image_path ? `
                            <div class="recipe-image">
                                <img src="${recipe.image_path}" alt="${recipe.name}">
                            </div>
                        ` : ''}
                        
                        <div class="recipe-info">
                            <div class="recipe-stats">
                                <span>🕒 ${recipe.time} mins</span>
                                <span>🔥 ${recipe.calories} cal</span>
                                <span>📊 ${recipe.difficulty}</span>
                                ${recipe.cuisine ? `<span>🌍 ${recipe.cuisine}</span>` : ''}
                            </div>
                            
                            <div class="recipe-ingredients">
                                <h3>Ingredients</h3>
                                <ul>
                                    ${recipe.ingredients.map(ing => `
                                        <li>${ing}</li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            <div class="recipe-instructions">
                                <h3>Instructions</h3>
                                <ol>
                                    ${recipe.instructions.split('\n').map(step => `
                                        <li>${step.trim()}</li>
                                    `).join('')}
                                </ol>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Add close functionality
                const closeBtn = modal.querySelector('.close');
                closeBtn.onclick = function() {
                    modal.remove();
                }
                
                // Close modal when clicking outside
                window.onclick = function(event) {
                    if (event.target === modal) {
                        modal.remove();
                    }
                }
                
            } catch (error) {
                console.error('Error viewing recipe details:', error);
                alert('Failed to load recipe details');
            }
        }

        // Add this to your existing JavaScript
        document.querySelectorAll('input[name="has_allergies"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const allergyOptions = document.querySelector('.allergy-options');
                allergyOptions.style.display = this.value === 'yes' ? 'block' : 'none';
            });
        });

        // Add event listener for the Recipe Recommendations button
        document.getElementById('recipeRecommendationsButton').addEventListener('click', function() {
            if (!currentUserEmail) {
                alert('Please sign in to view recipe recommendations');
                return;
            }
            
            // Hide all sections
            hideAllSections();
            
            // Show recommendations section
            document.getElementById('recipeRecommendationsSection').classList.remove('hidden');
            
            // Load recipe recommendations
            loadRecipeRecommendations();
        });

        // Add event listener for the fridge recommendations button
        document.getElementById('showFridgeRecipesBtn').addEventListener('click', function() {
            const recommendationsDiv = document.getElementById('fridgeRecipeRecommendations');
            
            if (recommendationsDiv.classList.contains('hidden')) {
                loadFridgeRecipeRecommendations();
                recommendationsDiv.classList.remove('hidden');
                this.textContent = 'Hide Recipe Recommendations';
            } else {
                recommendationsDiv.classList.add('hidden');
                this.textContent = 'Show Recipe Recommendations';
            }
        });

        async function loadFridgeRecipeRecommendations() {
            try {
                const response = await fetch(`/get_recipes_from_fridge?user_email=${currentUserEmail}`);
                if (!response.ok) throw new Error('Failed to load recommendations');
                
                const recipes = await response.json();
                displayFridgeRecipeRecommendations(recipes);
            } catch (error) {
                console.error('Error loading fridge recommendations:', error);
                document.getElementById('fridgeRecipeRecommendations').innerHTML = 
                    '<p class="error-message">Failed to load recipe recommendations. Please try again later.</p>';
            }
        }

        function displayFridgeRecipeRecommendations(recipes) {
            const container = document.getElementById('fridgeRecipeRecommendations');
            container.innerHTML = '';

            if (recipes.length === 0) {
                container.innerHTML = '<p>No recipes found matching your fridge ingredients. Try adding more ingredients!</p>';
                return;
            }

            recipes.forEach(recipe => {
                const card = document.createElement('div');
                card.className = 'recipe-card';
                
                card.innerHTML = `
                    <div class="match-info">
                        <div class="match-percentage">${Math.round(recipe.match_percentage)}% Match</div>
                        <div class="ingredients-match">
                            ${recipe.matching_ingredients} of ${recipe.total_ingredients} ingredients available
                        </div>
                    </div>
                    <div class="recipe-details">
                        <h4>${recipe.name}</h4>
                        <div class="recipe-stats">
                            <span>🕒 ${recipe.time} mins</span>
                            <span>🔥 ${recipe.calories || 'N/A'} cal</span>
                            <span>📊 ${recipe.difficulty}</span>
                        </div>
                        <div class="recipe-ingredients">
                            <strong>Ingredients needed:</strong><br>
                            ${recipe.ingredients.map(ing => `<span>${ing}</span>`).join(' ')}
                        </div>
                    </div>
                    <div class="recipe-actions">
                        <button onclick="viewRecipeDetails('${recipe.recipe_id}')" class="view-recipe-btn">
                            View Recipe
                        </button>
                        <div class="recipe-list-actions">
                            <button onclick="addToRecipeList('${recipe.recipe_id}', 'liked')" class="list-action-btn liked-btn">
                                <span class="icon">❤️</span> Like
                            </button>
                            <button onclick="addToRecipeList('${recipe.recipe_id}', 'cooked')" class="list-action-btn cooked-btn">
                                <span class="icon">👨‍🍳</span> Cooked
                            </button>
                            <button onclick="addToRecipeList('${recipe.recipe_id}', 'want_to_try')" class="list-action-btn want-to-try-btn">
                                <span class="icon">🔖</span> Want to Try
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Add function to handle adding recipes to lists
        async function addToRecipeList(recipeId, listType) {
            if (!currentUserEmail) {
                alert('Please sign in to add recipes to your lists');
                return;
            }

            try {
                const response = await fetch('/add_to_recipe_list', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_email: currentUserEmail,
                        recipe_id: recipeId,
                        list_type: listType
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to add recipe to list');
                }

                const data = await response.json();
                
                // Show success message
                const listNames = {
                    'liked': 'Liked Recipes',
                    'cooked': 'Cooked Recipes',
                    'want_to_try': 'Want to Try'
                };
                
                alert(`Recipe added to ${listNames[listType]}!`);
                
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to add recipe to list. Please try again.');
            }
        }

        // Shopping list functionality
        function addShoppingItem() {
            const input = document.getElementById('newItem');
            const itemName = input.value.trim();
            
            if (itemName) {
                const list = document.getElementById('shoppingList');
                const li = document.createElement('li');
                li.className = 'shopping-list-item';
                
                li.innerHTML = `
                    <input type="checkbox" class="shopping-list-checkbox" onchange="handleItemCheck(this)">
                    <span class="shopping-list-text">${itemName}</span>
                    <button class="shopping-list-delete" onclick="deleteShoppingItem(this)">🗑️</button>
                `;
                
                list.appendChild(li);
                input.value = '';
            }
        }

        function deleteShoppingItem(button) {
            button.parentElement.remove();
        }

        function handleItemCheck(checkbox) {
            if (checkbox.checked) {
                const itemName = checkbox.nextElementSibling.textContent;
                openAddToFridgeModal(itemName);
            }
        }

        // Modal functionality
        function openAddToFridgeModal(itemName) {
            const modal = document.getElementById('addToFridgeModal');
            document.getElementById('modalIngredientName').value = itemName;
            
            // Set default expiry date to 7 days from now
            const defaultExpiry = new Date();
            defaultExpiry.setDate(defaultExpiry.getDate() + 7);
            document.getElementById('modalExpiryDate').value = defaultExpiry.toISOString().split('T')[0];
            
            modal.style.display = 'block';
        }

        // Close modal when clicking the X
        document.querySelector('#addToFridgeModal .close').onclick = function() {
            document.getElementById('addToFridgeModal').style.display = 'none';
        }

        // Handle form submission
        document.getElementById('addToFridgeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const ingredientData = {
                user_email: currentUserEmail,
                category: document.getElementById('modalIngredientCategory').value,
                name: document.getElementById('modalIngredientName').value,
                amount: parseFloat(document.getElementById('modalIngredientAmount').value),
                unit: document.getElementById('modalIngredientUnit').value,
                expiry_date: document.getElementById('modalExpiryDate').value
            };

            try {
                const response = await fetch('/add_fridge_ingredient', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(ingredientData)
                });

                if (!response.ok) throw new Error('Failed to add ingredient to fridge');

                // Close modal and remove item from shopping list
                document.getElementById('addToFridgeModal').style.display = 'none';
                const checkedItem = document.querySelector('.shopping-list-checkbox:checked').parentElement;
                checkedItem.remove();

                // Show success message
                alert('Item added to your fridge!');
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to add item to fridge. Please try again.');
            }
        });

        // Load shopping list items when the page loads
        function loadShoppingList() {
            const list = document.getElementById('shoppingList');
            const savedItems = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            
            list.innerHTML = ''; // Clear current list
            savedItems.forEach(itemName => {
                const li = createShoppingListItem(itemName);
                list.appendChild(li);
            });
        }

        // Create shopping list item element
        function createShoppingListItem(itemName) {
            const li = document.createElement('li');
            li.className = 'shopping-list-item';
            
            li.innerHTML = `
                <input type="checkbox" class="shopping-list-checkbox" onchange="handleItemCheck(this)">
                <span class="shopping-list-text">${itemName}</span>
                <button class="shopping-list-delete" onclick="deleteShoppingItem(this)">🗑️</button>
            `;
            
            return li;
        }

        // Add item to shopping list
        function addShoppingItem() {
            const input = document.getElementById('newItem');
            const itemName = input.value.trim();
            
            if (itemName) {
                // Add to DOM
                const list = document.getElementById('shoppingList');
                const li = createShoppingListItem(itemName);
                list.appendChild(li);
                
                // Save to localStorage
                const savedItems = JSON.parse(localStorage.getItem('shoppingList') || '[]');
                savedItems.push(itemName);
                localStorage.setItem('shoppingList', JSON.stringify(savedItems));
                
                input.value = '';
            }
        }

        // Delete item from shopping list
        function deleteShoppingItem(button) {
            const itemName = button.previousElementSibling.textContent;
            
            // Remove from DOM
            button.parentElement.remove();
            
            // Remove from localStorage
            const savedItems = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            const updatedItems = savedItems.filter(item => item !== itemName);
            localStorage.setItem('shoppingList', JSON.stringify(updatedItems));
        }

        // Handle item check
        function handleItemCheck(checkbox) {
            if (checkbox.checked) {
                const itemName = checkbox.nextElementSibling.textContent;
                openAddToFridgeModal(itemName);
            }
        }

        // Update the existing addToFridgeForm submit handler
        document.getElementById('addToFridgeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const ingredientData = {
                user_email: currentUserEmail,
                category: document.getElementById('modalIngredientCategory').value,
                name: document.getElementById('modalIngredientName').value,
                amount: parseFloat(document.getElementById('modalIngredientAmount').value),
                unit: document.getElementById('modalIngredientUnit').value,
                expiry_date: document.getElementById('modalExpiryDate').value
            };

            try {
                const response = await fetch('/add_fridge_ingredient', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(ingredientData)
                });

                if (!response.ok) throw new Error('Failed to add ingredient to fridge');

                // Close modal
                document.getElementById('addToFridgeModal').style.display = 'none';
                
                // Get the item name and remove it from localStorage
                const itemName = document.getElementById('modalIngredientName').value;
                const savedItems = JSON.parse(localStorage.getItem('shoppingList') || '[]');
                const updatedItems = savedItems.filter(item => item !== itemName);
                localStorage.setItem('shoppingList', JSON.stringify(updatedItems));

                // Remove the item from the DOM
                const checkedItem = document.querySelector('.shopping-list-checkbox:checked').parentElement;
                checkedItem.remove();

                // Reset the form
                e.target.reset();

                // Show success message
                alert('Item added to your fridge!');

                // Refresh the fridge contents to show the new item
                if (typeof loadFridgeContents === 'function') {
                    await loadFridgeContents();
                }

            } catch (error) {
                console.error('Error:', error);
                alert('Failed to add item to fridge. Please try again.');
            }
        });

        // Update the handleItemCheck function
        function handleItemCheck(checkbox) {
            if (checkbox.checked) {
                const itemName = checkbox.nextElementSibling.textContent;
                openAddToFridgeModal(itemName);
                
                // Uncheck other checkboxes
                document.querySelectorAll('.shopping-list-checkbox').forEach(cb => {
                    if (cb !== checkbox) {
                        cb.checked = false;
                    }
                });
            }
        }

        // Update the loadShoppingList function
        function loadShoppingList() {
            const list = document.getElementById('shoppingList');
            const savedItems = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            
            list.innerHTML = ''; // Clear current list
            savedItems.forEach(itemName => {
                const li = createShoppingListItem(itemName);
                list.appendChild(li);
            });
        }

        // Update the deleteShoppingItem function
        function deleteShoppingItem(button) {
            const itemName = button.previousElementSibling.textContent;
            
            // Remove from DOM
            button.parentElement.remove();
            
            // Remove from localStorage
            const savedItems = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            const updatedItems = savedItems.filter(item => item !== itemName);
            localStorage.setItem('shoppingList', JSON.stringify(updatedItems));
        }

        async function loadFridgeContents() {
            try {
                const response = await fetch(`/get_fridge_items?user_email=${encodeURIComponent(currentUserEmail)}`);
                const items = await response.json();
                
                // Clear existing lists
                document.getElementById('freshIngredients').innerHTML = '';
                document.getElementById('expiringSoonIngredients').innerHTML = '';
                document.getElementById('expiredIngredients').innerHTML = '';
                
                items.forEach(item => {
                    const expiryDate = new Date(item.expiry_date);
                    const today = new Date();
                    const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                    
                    const ingredientElement = createIngredientElement(item, daysUntilExpiry);
                    
                    // Add to appropriate category
                    if (daysUntilExpiry < 0) {
                        document.getElementById('expiredIngredients').appendChild(ingredientElement);
                    } else if (daysUntilExpiry <= 7) {
                        document.getElementById('expiringSoonIngredients').appendChild(ingredientElement);
                    } else {
                        document.getElementById('freshIngredients').appendChild(ingredientElement);
                    }
                });
            } catch (error) {
                console.error('Error loading fridge contents:', error);
                alert('Failed to load fridge contents. Please try again.');
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'No date';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        async function deleteIngredient(id) {
            if (!confirm('Are you sure you want to delete this ingredient?')) {
                return;
            }

            try {
                const response = await fetch(`/remove_fridge_item/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_email: currentUserEmail })
                });

                if (response.ok) {
                    await loadFridgeContents(); // Refresh the list
                    alert('Ingredient deleted successfully');
                } else {
                    throw new Error('Failed to delete ingredient');
                }
            } catch (error) {
                console.error('Error deleting ingredient:', error);
                alert('Failed to delete ingredient. Please try again.');
            }
        }

        // Load fridge contents when the section is shown
        document.getElementById('myFridgeButton').addEventListener('click', loadFridgeContents);

        async function addToFridge() {
            const ingredientData = {
                user_email: currentUserEmail,
                name: document.getElementById('ingredientName').value,
                category: document.getElementById('ingredientCategory').value,
                amount: parseFloat(document.getElementById('ingredientAmount').value),
                unit: document.getElementById('ingredientUnit').value,
                expiry_date: document.getElementById('expiryDate').value
            };

            try {
                const response = await fetch('/add_fridge_ingredient', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(ingredientData)
                });

                const data = await response.json();

                if (response.ok) {
                    // Clear form
                    document.getElementById('ingredientName').value = '';
                    document.getElementById('ingredientCategory').value = '';
                    document.getElementById('ingredientAmount').value = '';
                    document.getElementById('ingredientUnit').value = '';
                    document.getElementById('expiryDate').value = '';

                    // Refresh fridge contents immediately
                    await loadFridgeContents();
                    alert('Ingredient added successfully!');
                } else {
                    throw new Error(data.error || 'Failed to add ingredient');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to add ingredient. Please try again.');
            }
        }

        function createIngredientElement(item, daysUntilExpiry) {
            const div = document.createElement('div');
            div.className = `ingredient-item ${daysUntilExpiry < 0 ? 'expired' : daysUntilExpiry <= 7 ? 'expiring-soon' : ''}`;
            
            // Ensure all values are properly formatted
            const ingredientName = item.ingredient || '';
            const amount = typeof item.amount === 'number' ? item.amount : parseFloat(item.amount) || 0;
            const unit = item.unit || '';
            const category = item.category || '';
            const expiryDate = item.expiry_date || '';
            
            div.innerHTML = `
                <div class="ingredient-info">
                    <div class="ingredient-name">${ingredientName}</div>
                    <div class="ingredient-details">${amount} ${unit}</div>
                    <div class="ingredient-details">${category}</div>
                    <div class="expiry-date">${formatDate(expiryDate)}</div>
                </div>
                <button class="delete-ingredient" onclick="deleteIngredient('${item.id}')">🗑️</button>
            `;
            
            return div;
        }

        async function loadFridgeContents() {
            try {
                if (!currentUserEmail) {
                    console.error('No user email found');
                    return;
                }

                const response = await fetch(`/get_fridge_items?user_email=${encodeURIComponent(currentUserEmail)}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch fridge items');
                }

                const items = await response.json();
                
                // Clear existing lists
                document.getElementById('freshIngredients').innerHTML = '';
                document.getElementById('expiringSoonIngredients').innerHTML = '';
                document.getElementById('expiredIngredients').innerHTML = '';
                
                items.forEach(item => {
                    if (!item || !item.expiry_date) {
                        console.error('Invalid item data:', item);
                        return;
                    }

                    const expiryDate = new Date(item.expiry_date);
                    const today = new Date();
                    const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                    
                    const ingredientElement = createIngredientElement(item, daysUntilExpiry);
                    
                    // Add to appropriate category
                    if (daysUntilExpiry < 0) {
                        document.getElementById('expiredIngredients').appendChild(ingredientElement);
                    } else if (daysUntilExpiry <= 7) {
                        document.getElementById('expiringSoonIngredients').appendChild(ingredientElement);
                    } else {
                        document.getElementById('freshIngredients').appendChild(ingredientElement);
                    }
                });
            } catch (error) {
                console.error('Error loading fridge contents:', error);
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString(undefined, {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (error) {
                console.error('Error formatting date:', error);
                return '';
            }
        }

        // Add event listener for section visibility
        document.getElementById('myFridgeButton').addEventListener('click', () => {
            loadFridgeContents();
        });

        async function submitSurvey(event) {
            event.preventDefault();
            
            const surveyData = {
                dietaryRestrictions: Array.from(document.querySelectorAll('input[name="dietary"]:checked')).map(cb => cb.value),
                cuisinePreferences: Array.from(document.querySelectorAll('input[name="cuisine"]:checked')).map(cb => cb.value),
                cookingSkill: document.querySelector('input[name="cooking-skill"]:checked')?.value || '',
                cookingFrequency: document.querySelector('input[name="cooking-frequency"]:checked')?.value || '',
                mealPreferences: Array.from(document.querySelectorAll('input[name="meal-type"]:checked')).map(cb => cb.value)
            };

            try {
                // Save survey data
                const response = await fetch('/save_survey', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_email: currentUserEmail,
                        survey_data: surveyData
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to save preferences');
                }

                // Close survey modal
                closeSurveyModal();

                // Switch to recommendations section
                hideAllSections();
                const recommendationsSection = document.getElementById('recommendationsSection');
                recommendationsSection.classList.remove('hidden');

                // Load recommended recipes
                const recipesResponse = await fetch(`/get_recommended_recipes?user_email=${encodeURIComponent(currentUserEmail)}`);
                const recipesData = await recipesResponse.json();

                if (!recipesResponse.ok) {
                    throw new Error('Failed to load recommendations');
                }

                // Display recommended recipes
                const recommendationsContainer = document.getElementById('recommendationsContainer');
                recommendationsContainer.innerHTML = '<h2>Recommended Recipes Based on Your Preferences</h2>';

                if (recipesData.recipes && recipesData.recipes.length > 0) {
                    const recipeGrid = document.createElement('div');
                    recipeGrid.className = 'recipe-grid';

                    recipesData.recipes.forEach(recipe => {
                        const recipeCard = document.createElement('div');
                        recipeCard.className = 'recipe-card';
                        recipeCard.innerHTML = `
                            <img src="${recipe.image || 'default-recipe-image.jpg'}" alt="${recipe.name}">
                            <div class="recipe-card-content">
                                <h4>${recipe.name}</h4>
                                <div class="recipe-meta">
                                    <span>${recipe.cuisineType.join(', ')}</span>
                                    <span>${recipe.cookingTime} mins</span>
                                </div>
                                <button class="view-details-btn" onclick="showRecipeDetails('${recipe.id}')">
                                    View Details
                                </button>
                            </div>
                        `;
                        recipeGrid.appendChild(recipeCard);
                    });

                    recommendationsContainer.appendChild(recipeGrid);
                } else {
                    recommendationsContainer.innerHTML += `
                        <div class="empty-state">
                            <p>No recipes found matching your preferences. Try adjusting your preferences.</p>
                        </div>
                    `;
                }

                alert('Preferences saved successfully! Check out your personalized recipe recommendations.');
            } catch (error) {
                console.error('Error:', error);
                alert(error.message);
            }
        }

        function createOrUpdatePreferencesSection(data) {
            const profileSection = document.getElementById('profileSection');
            
            // Remove existing preferences section if it exists
            const existingPreferences = document.querySelector('.profile-preferences');
            if (existingPreferences) {
                existingPreferences.remove();
            }

            // Create new preferences section
            const preferencesSection = document.createElement('div');
            preferencesSection.className = 'profile-preferences';
            
            const formatList = (list) => Array.isArray(list) && list.length > 0 ? list.join(', ') : 'None specified';
            
            preferencesSection.innerHTML = `
                <h3>My Preferences</h3>
                <div class="preferences-container">
                    <div class="preference-group">
                        <h4>Dietary Restrictions</h4>
                        <p id="userDietary">${formatList(data.dietaryRestrictions)}</p>
                    </div>
                    <div class="preference-group">
                        <h4>Favorite Cuisines</h4>
                        <p id="userCuisines">${formatList(data.cuisinePreferences)}</p>
                    </div>
                    <div class="preference-group">
                        <h4>Cooking Experience</h4>
                        <p id="userCookingSkill">${data.cookingSkill || 'Not specified'}</p>
                    </div>
                    <div class="preference-group">
                        <h4>Cooking Frequency</h4>
                        <p id="userCookingFrequency">${data.cookingFrequency || 'Not specified'}</p>
                    </div>
                    <div class="preference-group">
                        <h4>Meal Preferences</h4>
                        <p id="userMealPreferences">${formatList(data.mealPreferences)}</p>
                    </div>
                    <button onclick="openSurveyModal()" class="edit-preferences-btn">Edit Preferences</button>
                </div>
            `;

            // Add the preferences section to the profile
            profileSection.appendChild(preferencesSection);
        }

        // Add this style if not already present
        const style = document.createElement('style');
        style.textContent = `
            .profile-preferences {
                margin-top: 20px;
                padding: 20px;
                background-color: #f8f9fa;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .preferences-container {
                display: grid;
                gap: 15px;
            }

            .preference-group {
                background-color: white;
                padding: 15px;
                border-radius: 6px;
            }

            .preference-group h4 {
                margin: 0 0 8px 0;
                color: #2c3e50;
            }

            .preference-group p {
                margin: 0;
                color: #34495e;
            }

            .edit-preferences-btn {
                margin-top: 15px;
                padding: 8px 16px;
                background-color: #3498db;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                transition: background-color 0.3s;
            }

            .edit-preferences-btn:hover {
                background-color: #2980b9;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>